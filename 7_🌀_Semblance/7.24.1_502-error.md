This page isnâ€™t working
shiny-capybara-55rwj7pggxh7r66-80.app.github.dev is currently unable to handle this request.
HTTP ERROR 502

>>>>>>>>>>

services:
  moodle:
    image: my-moodle:latest
    container_name: moodle_app
    restart: always
    ports:
      - "80:80"
    environment:
      MOODLE_DATABASE_TYPE: mariadb
      MOODLE_DATABASE_HOST: db
      MOODLE_DATABASEa_PORT_NUMBER: 3306
      MOODLE_DATABASE_NAME: moodle
      MOODLE_DATABASE_USER: moodle
      MOODLE_DATABASE_PASSWORD: "SafeP@ssw0rd-123"
      MOODLE_USERNAME: admin
      MOODLE_PASSWORD: "SecureAdminP@ssw0rd456"
      MOODLE_EMAIL: contact@rifaterdemsahin.com
      MOODLE_SITE_NAME: "Moodle LMS"
      MOODLE_HOST: "localhost"
      PHP_MAX_EXECUTION_TIME: 300
      PHP_MEMORY_LIMIT: 256M
      PHP_POST_MAX_SIZE: 50M
      PHP_UPLOAD_MAX_FILESIZE: 50M
      BITNAMI_DEBUG: "true"
    volumes:
      - moodle_data:/bitnami/moodle
      - moodledata_data:/bitnami/moodledata
    depends_on:
      - db
    networks:
      - moodle-net
    command: >
      bash -c "if [ ! -f /bitnami/moodle/config.php ]; then /opt/bitnami/scripts/moodle/entrypoint.sh /opt/bitnami/scripts/moodle/run.sh; else php /bitnami/moodle/admin/cli/install_database.php && /opt/bitnami/scripts/moodle/run.sh; fi"

  db:
    image: mariadb:10.6
    container_name: moodle_db
    restart: always
    environment:
      MYSQL_DATABASE: moodle
      MYSQL_USER: moodle
      MYSQL_PASSWORD: "SafeP@ssw0rd-123"
      MYSQL_ROOT_PASSWORD: "RootP@ssw0rd789"
    volumes:
      - db_data:/var/lib/mysql
    networks:
      - moodle-net
    command: --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci

volumes:
  moodle_data:
  moodledata_data:
  db_data:

networks:
  moodle-net:
    driver: bridge

>>>>>>

@rifaterdemsahin âžœ /workspaces/Moodle/1_ðŸŒ_Real (main) $ docker ps -a
CONTAINER ID   IMAGE                   COMMAND                  CREATED         STATUS                    PORTS                                                   NAMES
b80f2504882d   my-moodle:latest        "/opt/bitnami/scriptâ€¦"   3 minutes ago   Up 3 minutes              8080/tcp, 0.0.0.0:80->80/tcp, :::80->80/tcp, 8443/tcp   moodle_app
1e8a1ceec065   mariadb:10.6            "docker-entrypoint.sâ€¦"   3 minutes ago   Up 3 minutes              3306/tcp                                                moodle_db
f560ce149f57   bitnami/moodle:latest   "bash"                   30 hours ago    Exited (1) 30 hours ago                                                           gracious_elbakyan
@rifaterdemsahin âžœ /workspaces/Moodle/1_ðŸŒ_Real (main) $ 

>>>>>>>>>>

/fix

---

It looks like you're experiencing an HTTP 502 error with your Moodle setup in Docker. Let me help troubleshoot this issue.

Based on your logs and configuration, I can see a few potential issues:

## Main Issues

1. **Typo in Environment Variable**: There's a typo in your docker-compose.yml file:
   ```
   MOODLE_DATABASEa_PORT_NUMBER: 3306
   ```
   Should be:
   ```
   MOODLE_DATABASE_PORT_NUMBER: 3306
   ```

2. **Startup Command Complexity**: Your custom command for the Moodle container is quite complex and might be causing problems during initialization.

3. **Container Status**: Your containers are running, but the web interface is returning a 502 error, which typically indicates that the web server is running but the application itself might not be properly initialized.

## Suggested Fixes

```yaml
services:
  moodle:
    image: my-moodle:latest
    container_name: moodle_app
    restart: always
    ports:
      - "80:80"
    environment:
      MOODLE_DATABASE_TYPE: mariadb
      MOODLE_DATABASE_HOST: db
      MOODLE_DATABASE_PORT_NUMBER: 3306  # Fixed typo here
      MOODLE_DATABASE_NAME: moodle
      MOODLE_DATABASE_USER: moodle
      MOODLE_DATABASE_PASSWORD: "SafeP@ssw0rd-123"
      MOODLE_USERNAME: admin
      MOODLE_PASSWORD: "SecureAdminP@ssw0rd456"
      MOODLE_EMAIL: contact@rifaterdemsahin.com
      MOODLE_SITE_NAME: "Moodle LMS"
      MOODLE_HOST: "localhost"
      PHP_MAX_EXECUTION_TIME: 300
      PHP_MEMORY_LIMIT: 256M
      PHP_POST_MAX_SIZE: 50M
      PHP_UPLOAD_MAX_FILESIZE: 50M
      BITNAMI_DEBUG: "true"
    volumes:
      - moodle_data:/bitnami/moodle
      - moodledata_data:/bitnami/moodledata
    depends_on:
      - db
    networks:
      - moodle-net

  db:
    image: mariadb:10.6
    container_name: moodle_db
    restart: always
    environment:
      MYSQL_DATABASE: moodle
      MYSQL_USER: moodle
      MYSQL_PASSWORD: "SafeP@ssw0rd-123"
      MYSQL_ROOT_PASSWORD: "RootP@ssw0rd789"
    volumes:
      - db_data:/var/lib/mysql
    networks:
      - moodle-net
    command: --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci

volumes:
  moodle_data:
  moodledata_data:
  db_data:

networks:
  moodle-net:
    driver: bridge

```

## Action Steps

1. **Update your docker-compose.yml** with the fixed version above.

2. **Reset the setup** completely:
   ```bash
   docker-compose down -v
   docker-compose up -d
   ```

3. **Check logs** to see what's happening during startup:
   ```bash
   docker logs moodle_app
   ```

4. **Verify database connectivity** from the Moodle container:
   ```bash
   docker exec -it moodle_app bash
   ping db
   mysql -h db -u moodle -p'SafeP@ssw0rd-123' -e "SHOW DATABASES;"
   ```

5. **Check if Moodle is properly installed**:
   ```bash
   docker exec -it moodle_app ls -la /bitnami/moodle/config.php
   ```

If the issue persists after these steps, it might be related to the `my-moodle:latest` image. Consider trying the official Bitnami image directly:

```yaml
moodle:
  image: bitnami/moodle:latest
  # rest of your configuration
```

Let me know if you need more specific help based on the results of these troubleshooting steps.