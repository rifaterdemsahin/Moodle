version: '3'

services:
  moodle:
    image: my-moodle:latest
    container_name: moodle_app
    restart: always
    ports:
      - "80:80"
    environment:
      MOODLE_DATABASE_TYPE: mysqli
      MOODLE_DATABASE_HOST: db
      MOODLE_DATABASE_PORT_NUMBER: 3306
      MOODLE_DATABASE_NAME: moodle
      MOODLE_DATABASE_USER: moodle
      MOODLE_DATABASE_PASSWORD: "SafeP@ssw0rd-123"
      MOODLE_USERNAME: admin
      MOODLE_PASSWORD: "SecureAdminP@ssw0rd456"
      MOODLE_EMAIL: contact@rifaterdemsahin.com
      MOODLE_SITE_NAME: "Moodle LMS"
      MOODLE_HOST: "localhost"
      PHP_MAX_EXECUTION_TIME: 300
      PHP_MEMORY_LIMIT: 256M
      PHP_POST_MAX_SIZE: 50M
      PHP_UPLOAD_MAX_FILESIZE: 50M
      BITNAMI_DEBUG: "true"
    volumes:
      - moodle_data:/bitnami/moodle
      - moodledata_data:/bitnami/moodledata
    depends_on:
      - db
    networks:
      - moodle-net

  db:
    image: mariadb:10.6
    container_name: moodle_db
    restart: always
    environment:
      MYSQL_DATABASE: moodle
      MYSQL_USER: moodle
      MYSQL_PASSWORD: "SafeP@ssw0rd-123"
      MYSQL_ROOT_PASSWORD: "RootP@ssw0rd789"
    volumes:
      - db_data:/var/lib/mysql
    networks:
      - moodle-net
    command: --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci

volumes:
  moodle_data:
  moodledata_data:
  db_data:

networks:
  moodle-net:
    driver: bridge
---

rifaterdemsahin@MacBookPro 3_local % docker-compose down -v

WARN[0000] /Users/rifaterdemsahin/projects/Moodle/6_ðŸ”£_Symbols/3_local/docker-compose.yml: the attribute `version` is obsolete, it will be ignored, please remove it to avoid potential confusion 
[+] Running 6/6
 âœ” Container moodle_app            Removed                                                                               0.0s 
 âœ” Container moodle_db             Removed                                                                               0.0s 
 âœ” Volume 3_local_moodledata_data  Removed                                                                               0.0s 
 âœ” Volume 3_local_db_data          Removed                                                                               0.0s 
 âœ” Volume 3_local_moodle_data      Removed                                                                               0.0s 
 âœ” Network 3_local_moodle-net      Removed                                                                               0.3s 
rifaterdemsahin@MacBookPro 3_local % docker-compose up --force-recreate

WARN[0000] /Users/rifaterdemsahin/projects/Moodle/6_ðŸ”£_Symbols/3_local/docker-compose.yml: the attribute `version` is obsolete, it will be ignored, please remove it to avoid potential confusion 
[+] Running 6/6
 âœ” Network 3_local_moodle-net        Created                                                                             0.1s 
 âœ” Volume "3_local_moodledata_data"  Created                                                                             0.0s 
 âœ” Volume "3_local_db_data"          Created                                                                             0.0s 
 âœ” Volume "3_local_moodle_data"      Created                                                                             0.0s 
 âœ” Container moodle_db               Created                                                                             0.0s 
 âœ” Container moodle_app              Created                                                                             0.0s 
Attaching to moodle_app, moodle_db
moodle_db   | 2025-03-16 21:19:33+00:00 [Note] [Entrypoint]: Entrypoint script for MariaDB Server 1:10.6.21+maria~ubu2004 started.
moodle_db   | 2025-03-16 21:19:33+00:00 [Note] [Entrypoint]: Switching to dedicated user 'mysql'
moodle_app  | moodle 21:19:33.46 INFO  ==> 
moodle_app  | moodle 21:19:33.46 INFO  ==> Welcome to the Bitnami moodle container
moodle_app  | moodle 21:19:33.46 INFO  ==> Subscribe to project updates by watching https://github.com/bitnami/containers
moodle_app  | moodle 21:19:33.46 INFO  ==> Did you know there are enterprise versions of the Bitnami catalog? For enhanced secure software supply chain features, unlimited pulls from Docker, LTS support, or application customization, see Bitnami Premium or Tanzu Application Catalog. See https://www.arrow.com/globalecs/na/vendors/bitnami/ for more information.
moodle_app  | moodle 21:19:33.46 INFO  ==> 
moodle_db   | 2025-03-16 21:19:33+00:00 [Note] [Entrypoint]: Entrypoint script for MariaDB Server 1:10.6.21+maria~ubu2004 started.
moodle_app  | moodle 21:19:33.46 INFO  ==> ** Starting Moodle setup **
moodle_app  | moodle 21:19:33.47 DEBUG ==> Validating settings in APACHE_* environment variables
moodle_app  | moodle 21:19:33.48 DEBUG ==> Copying files from /opt/bitnami/apache/conf.default to /opt/bitnami/apache/conf
moodle_app  | moodle 21:19:33.49 INFO  ==> Generating sample certificates
moodle_db   | 2025-03-16 21:19:33+00:00 [Note] [Entrypoint]: Initializing database files
moodle_db   | 2025-03-16 21:19:34+00:00 [Note] [Entrypoint]: Database files initialized
moodle_db   | 2025-03-16 21:19:34+00:00 [Note] [Entrypoint]: Starting temporary server
moodle_db   | 2025-03-16 21:19:34+00:00 [Note] [Entrypoint]: Waiting for server startup
moodle_db   | 2025-03-16 21:19:34 0 [Note] Starting MariaDB 10.6.21-MariaDB-ubu2004 source revision 066e8d6aeabc13242193780341e0f845528105de server_uid 72+4ASMvYxproTQgRqIDplDA1XA= as process 100
moodle_db   | 2025-03-16 21:19:34 0 [Note] InnoDB: Compressed tables use zlib 1.2.11
moodle_db   | 2025-03-16 21:19:34 0 [Note] InnoDB: Number of pools: 1
moodle_db   | 2025-03-16 21:19:34 0 [Note] InnoDB: Using ARMv8 crc32 + pmull instructions
moodle_db   | 2025-03-16 21:19:34 0 [Note] InnoDB: Using Linux native AIO
moodle_db   | 2025-03-16 21:19:34 0 [Note] InnoDB: Initializing buffer pool, total size = 134217728, chunk size = 134217728
moodle_db   | 2025-03-16 21:19:34 0 [Note] InnoDB: Completed initialization of buffer pool
moodle_db   | 2025-03-16 21:19:34 0 [Note] InnoDB: 128 rollback segments are active.
moodle_db   | 2025-03-16 21:19:34 0 [Note] InnoDB: Creating shared tablespace for temporary tables
moodle_db   | 2025-03-16 21:19:34 0 [Note] InnoDB: Setting file './ibtmp1' size to 12 MB. Physically writing the file full; Please wait ...
moodle_db   | 2025-03-16 21:19:34 0 [Note] InnoDB: File './ibtmp1' size is now 12 MB.
moodle_db   | 2025-03-16 21:19:34 0 [Note] InnoDB: 10.6.21 started; log sequence number 41354; transaction id 14
moodle_db   | 2025-03-16 21:19:34 0 [Note] Plugin 'FEEDBACK' is disabled.
moodle_db   | 2025-03-16 21:19:34 0 [Note] mariadbd: ready for connections.
moodle_db   | Version: '10.6.21-MariaDB-ubu2004'  socket: '/run/mysqld/mysqld.sock'  port: 0  mariadb.org binary distribution
moodle_app  | Certificate request self-signature ok
moodle_app  | subject=CN = example.com
moodle_app  | moodle 21:19:34.89 INFO  ==> Configuring Apache ServerTokens directive
moodle_app  | moodle 21:19:34.89 DEBUG ==> Configuring ServerTokens Prod on file /opt/bitnami/apache/conf/httpd.conf
moodle_app  | moodle 21:19:34.90 INFO  ==> Configuring PHP options
moodle_app  | moodle 21:19:34.91 INFO  ==> Setting PHP expose_php option
moodle_app  | moodle 21:19:34.91 INFO  ==> Setting PHP max_execution_time option
moodle_app  | moodle 21:19:34.92 INFO  ==> Setting PHP memory_limit option
moodle_app  | moodle 21:19:34.92 INFO  ==> Setting PHP post_max_size option
moodle_app  | moodle 21:19:34.93 INFO  ==> Setting PHP upload_max_filesize option
moodle_app  | moodle 21:19:34.93 INFO  ==> Setting PHP output_buffering option
moodle_app  | moodle 21:19:34.95 INFO  ==> Validating settings in MYSQL_CLIENT_* env vars
moodle_app  | moodle 21:19:34.95 INFO  ==> Validating settings in POSTGRESQL_CLIENT_* env vars
moodle_app  | moodle 21:19:34.97 DEBUG ==> Validating settings in MOODLE_* environment variables...
moodle_app  | moodle 21:19:35.00 INFO  ==> Ensuring Moodle directories exist
moodle_app  | moodle 21:19:35.01 INFO  ==> Trying to connect to the database server
moodle_app  | /opt/bitnami/mysql/bin/mysql: Deprecated program name. It will be removed in a future release, use '/opt/bitnami/mysql/bin/mariadb' instead
moodle_app  | moodle 21:19:35.02 DEBUG ==> Executing SQL command:
moodle_app  | SELECT 1
moodle_app  | /opt/bitnami/mysql/bin/mysql: Deprecated program name. It will be removed in a future release, use '/opt/bitnami/mysql/bin/mariadb' instead
moodle_app  | ERROR 2002 (HY000): Can't connect to server on 'db' (115)
moodle_db   | 2025-03-16 21:19:35+00:00 [Note] [Entrypoint]: Temporary server started.
moodle_db   | 2025-03-16 21:19:36+00:00 [Note] [Entrypoint]: Creating database moodle
moodle_db   | 2025-03-16 21:19:36+00:00 [Note] [Entrypoint]: Creating user moodle
moodle_db   | 2025-03-16 21:19:36+00:00 [Note] [Entrypoint]: Giving user moodle access to schema moodle
moodle_db   | 2025-03-16 21:19:36+00:00 [Note] [Entrypoint]: Securing system users (equivalent to running mysql_secure_installation)
moodle_db   | 
moodle_db   | 2025-03-16 21:19:36+00:00 [Note] [Entrypoint]: Stopping temporary server
moodle_db   | 2025-03-16 21:19:36 0 [Note] mariadbd (initiated by: unknown): Normal shutdown
moodle_db   | 2025-03-16 21:19:36 0 [Note] InnoDB: FTS optimize thread exiting.
moodle_db   | 2025-03-16 21:19:36 0 [Note] InnoDB: Starting shutdown...
moodle_db   | 2025-03-16 21:19:36 0 [Note] InnoDB: Dumping buffer pool(s) to /var/lib/mysql/ib_buffer_pool
moodle_db   | 2025-03-16 21:19:36 0 [Note] InnoDB: Buffer pool(s) dump completed at 250316 21:19:36
moodle_db   | 2025-03-16 21:19:36 0 [Note] InnoDB: Removed temporary tablespace data file: "./ibtmp1"
moodle_db   | 2025-03-16 21:19:36 0 [Note] InnoDB: Shutdown completed; log sequence number 42664; transaction id 15
moodle_db   | 2025-03-16 21:19:36 0 [Note] mariadbd: Shutdown complete
moodle_db   | 2025-03-16 21:19:36+00:00 [Note] [Entrypoint]: Temporary server stopped
moodle_db   | 
moodle_db   | 2025-03-16 21:19:36+00:00 [Note] [Entrypoint]: MariaDB init process done. Ready for start up.
moodle_db   | 
moodle_db   | 2025-03-16 21:19:36 0 [Note] Starting MariaDB 10.6.21-MariaDB-ubu2004 source revision 066e8d6aeabc13242193780341e0f845528105de server_uid 72+4ASMvYxproTQgRqIDplDA1XA= as process 1
moodle_db   | 2025-03-16 21:19:36 0 [Note] InnoDB: Compressed tables use zlib 1.2.11
moodle_db   | 2025-03-16 21:19:36 0 [Note] InnoDB: Number of pools: 1
moodle_db   | 2025-03-16 21:19:36 0 [Note] InnoDB: Using ARMv8 crc32 + pmull instructions
moodle_db   | 2025-03-16 21:19:36 0 [Note] InnoDB: Using Linux native AIO
moodle_db   | 2025-03-16 21:19:36 0 [Note] InnoDB: Initializing buffer pool, total size = 134217728, chunk size = 134217728
moodle_db   | 2025-03-16 21:19:36 0 [Note] InnoDB: Completed initialization of buffer pool
moodle_db   | 2025-03-16 21:19:36 0 [Note] InnoDB: 128 rollback segments are active.
moodle_db   | 2025-03-16 21:19:36 0 [Note] InnoDB: Creating shared tablespace for temporary tables
moodle_db   | 2025-03-16 21:19:36 0 [Note] InnoDB: Setting file './ibtmp1' size to 12 MB. Physically writing the file full; Please wait ...
moodle_db   | 2025-03-16 21:19:36 0 [Note] InnoDB: File './ibtmp1' size is now 12 MB.
moodle_db   | 2025-03-16 21:19:36 0 [Note] InnoDB: 10.6.21 started; log sequence number 42664; transaction id 15
moodle_db   | 2025-03-16 21:19:36 0 [Note] InnoDB: Loading buffer pool(s) from /var/lib/mysql/ib_buffer_pool
moodle_db   | 2025-03-16 21:19:36 0 [Note] Plugin 'FEEDBACK' is disabled.
moodle_db   | 2025-03-16 21:19:36 0 [Note] InnoDB: Buffer pool(s) load completed at 250316 21:19:36
moodle_db   | 2025-03-16 21:19:36 0 [Warning] You need to use --log-bin to make --expire-logs-days or --binlog-expire-logs-seconds work.
moodle_db   | 2025-03-16 21:19:36 0 [Note] Server socket created on IP: '0.0.0.0'.
moodle_db   | 2025-03-16 21:19:36 0 [Note] Server socket created on IP: '::'.
moodle_db   | 2025-03-16 21:19:36 0 [Note] mariadbd: ready for connections.
moodle_db   | Version: '10.6.21-MariaDB-ubu2004'  socket: '/run/mysqld/mysqld.sock'  port: 3306  mariadb.org binary distribution
moodle_app  | /opt/bitnami/mysql/bin/mysql: Deprecated program name. It will be removed in a future release, use '/opt/bitnami/mysql/bin/mariadb' instead
moodle_app  | moodle 21:19:40.05 DEBUG ==> Executing SQL command:
moodle_app  | SELECT 1
moodle_app  | /opt/bitnami/mysql/bin/mysql: Deprecated program name. It will be removed in a future release, use '/opt/bitnami/mysql/bin/mariadb' instead
moodle_app  | 1
moodle_app  | moodle 21:19:40.10 INFO  ==> Running Moodle install script
moodle_app  |                                  .-..-.       
moodle_app  |    _____                         | || |       
moodle_app  |   /____/-.---_  .---.  .---.  .-.| || | .---. 
moodle_app  |   | |  _   _  |/  _  \/  _  \/  _  || |/  __ \
moodle_app  |   * | | | | | || |_| || |_| || |_| || || |___/
moodle_app  |     |_| |_| |_|\_____/\_____/\_____||_|\_____)
moodle_app  | 
moodle_app  | Moodle 4.5.2 (Build: 20250210) command line installation program
moodle_app  | == Environment ==
moodle_app  | !! database mysql (10.6.21-MariaDB-ubu2004) !!
moodle_app  | [System] must be installed and enabled - Wrong $CFG->dbtype. You need to change it in your config.php file from
moodle_app  | 'mysqli' to 'mariadb'.
moodle_app  | 
moodle_app  | 
moodle_app exited with code 0
moodle_app  | moodle 21:19:40.72 DEBUG ==> Validating settings in APACHE_* environment variables
moodle_app  | moodle 21:19:40.72 DEBUG ==> Copying files from /opt/bitnami/apache/conf.default to /opt/bitnami/apache/conf
moodle_app  | moodle 21:19:40.73 INFO  ==> Configuring Apache ServerTokens directive
moodle_app  | moodle 21:19:40.73 DEBUG ==> Configuring ServerTokens Prod on file /opt/bitnami/apache/conf/httpd.conf
moodle_app  | moodle 21:19:40.75 INFO  ==> Configuring PHP options
moodle_app  | moodle 21:19:40.76 INFO  ==> Setting PHP expose_php option
moodle_app  | moodle 21:19:40.76 INFO  ==> Setting PHP max_execution_time option
moodle_app  | moodle 21:19:40.77 INFO  ==> Setting PHP memory_limit option
moodle_app  | moodle 21:19:40.77 INFO  ==> Setting PHP post_max_size option
moodle_app  | moodle 21:19:40.78 INFO  ==> Setting PHP upload_max_filesize option
moodle_app  | moodle 21:19:40.78 INFO  ==> Setting PHP output_buffering option
moodle_app  | moodle 21:19:40.80 INFO  ==> Validating settings in MYSQL_CLIENT_* env vars
moodle_app  | moodle 21:19:40.80 INFO  ==> Validating settings in POSTGRESQL_CLIENT_* env vars
moodle_app  | moodle 21:19:40.82 DEBUG ==> Validating settings in MOODLE_* environment variables...
moodle_app  | moodle 21:19:40.85 INFO  ==> Ensuring Moodle directories exist
moodle_app  | moodle 21:19:40.86 INFO  ==> Trying to connect to the database server
moodle_app  | /opt/bitnami/mysql/bin/mysql: Deprecated program name. It will be removed in a future release, use '/opt/bitnami/mysql/bin/mariadb' instead
moodle_app  | moodle 21:19:40.87 DEBUG ==> Executing SQL command:
moodle_app  | SELECT 1
moodle_app  | /opt/bitnami/mysql/bin/mysql: Deprecated program name. It will be removed in a future release, use '/opt/bitnami/mysql/bin/mariadb' instead
moodle_app  | 1
moodle_app  | moodle 21:19:40.90 INFO  ==> Running Moodle install script
moodle_app  | The configuration file config.php already exists. Please use admin/cli/install_database.php to install Moodle for this site.
moodle_app  | 
moodle_app exited with code 1
moodle_app  | moodle 21:19:41.54 DEBUG ==> Validating settings in APACHE_* environment variables
moodle_app  | moodle 21:19:41.55 DEBUG ==> Copying files from /opt/bitnami/apache/conf.default to /opt/bitnami/apache/conf
moodle_app  | moodle 21:19:41.56 INFO  ==> Configuring Apache ServerTokens directive
moodle_app  | moodle 21:19:41.56 DEBUG ==> Configuring ServerTokens Prod on file /opt/bitnami/apache/conf/httpd.conf
moodle_app  | moodle 21:19:41.57 INFO  ==> Configuring PHP options
moodle_app  | moodle 21:19:41.58 INFO  ==> Setting PHP expose_php option
moodle_app  | moodle 21:19:41.58 INFO  ==> Setting PHP max_execution_time option
moodle_app  | moodle 21:19:41.59 INFO  ==> Setting PHP memory_limit option
moodle_app  | moodle 21:19:41.59 INFO  ==> Setting PHP post_max_size option
moodle_app  | moodle 21:19:41.60 INFO  ==> Setting PHP upload_max_filesize option
moodle_app  | moodle 21:19:41.60 INFO  ==> Setting PHP output_buffering option
moodle_app  | moodle 21:19:41.62 INFO  ==> Validating settings in MYSQL_CLIENT_* env vars
moodle_app  | moodle 21:19:41.62 INFO  ==> Validating settings in POSTGRESQL_CLIENT_* env vars
moodle_app  | moodle 21:19:41.64 DEBUG ==> Validating settings in MOODLE_* environment variables...
moodle_app  | moodle 21:19:41.67 INFO  ==> Ensuring Moodle directories exist
moodle_app  | moodle 21:19:41.68 INFO  ==> Trying to connect to the database server
moodle_app  | /opt/bitnami/mysql/bin/mysql: Deprecated program name. It will be removed in a future release, use '/opt/bitnami/mysql/bin/mariadb' instead
moodle_app  | moodle 21:19:41.68 DEBUG ==> Executing SQL command:
moodle_app  | SELECT 1
moodle_app  | /opt/bitnami/mysql/bin/mysql: Deprecated program name. It will be removed in a future release, use '/opt/bitnami/mysql/bin/mariadb' instead
moodle_app  | 1
moodle_app  | moodle 21:19:41.72 INFO  ==> Running Moodle install script
moodle_app  | The configuration file config.php already exists. Please use admin/cli/install_database.php to install Moodle for this site.
moodle_app  | 
moodle_app exited with code 1
moodle_app  | moodle 21:19:42.34 DEBUG ==> Validating settings in APACHE_* environment variables
moodle_app  | moodle 21:19:42.35 DEBUG ==> Copying files from /opt/bitnami/apache/conf.default to /opt/bitnami/apache/conf
moodle_app  | moodle 21:19:42.35 INFO  ==> Configuring Apache ServerTokens directive
moodle_app  | moodle 21:19:42.35 DEBUG ==> Configuring ServerTokens Prod on file /opt/bitnami/apache/conf/httpd.conf
moodle_app  | moodle 21:19:42.37 INFO  ==> Configuring PHP options
moodle_app  | moodle 21:19:42.38 INFO  ==> Setting PHP expose_php option
moodle_app  | moodle 21:19:42.38 INFO  ==> Setting PHP max_execution_time option
moodle_app  | moodle 21:19:42.39 INFO  ==> Setting PHP memory_limit option
moodle_app  | moodle 21:19:42.39 INFO  ==> Setting PHP post_max_size option
moodle_app  | moodle 21:19:42.40 INFO  ==> Setting PHP upload_max_filesize option
moodle_app  | moodle 21:19:42.41 INFO  ==> Setting PHP output_buffering option
moodle_app  | moodle 21:19:42.42 INFO  ==> Validating settings in MYSQL_CLIENT_* env vars
moodle_app  | moodle 21:19:42.42 INFO  ==> Validating settings in POSTGRESQL_CLIENT_* env vars
moodle_app  | moodle 21:19:42.44 DEBUG ==> Validating settings in MOODLE_* environment variables...
moodle_app  | moodle 21:19:42.47 INFO  ==> Ensuring Moodle directories exist
moodle_app  | moodle 21:19:42.48 INFO  ==> Trying to connect to the database server
moodle_app  | /opt/bitnami/mysql/bin/mysql: Deprecated program name. It will be removed in a future release, use '/opt/bitnami/mysql/bin/mariadb' instead
moodle_app  | moodle 21:19:42.49 DEBUG ==> Executing SQL command:
moodle_app  | SELECT 1
moodle_app  | /opt/bitnami/mysql/bin/mysql: Deprecated program name. It will be removed in a future release, use '/opt/bitnami/mysql/bin/mariadb' instead
moodle_app  | 1
moodle_app  | moodle 21:19:42.52 INFO  ==> Running Moodle install script
moodle_app  | The configuration file config.php already exists. Please use admin/cli/install_database.php to install Moodle for this site.
moodle_app  | 
moodle_app exited with code 1
moodle_app  | moodle 21:19:43.51 DEBUG ==> Validating settings in APACHE_* environment variables
moodle_app  | moodle 21:19:43.52 DEBUG ==> Copying files from /opt/bitnami/apache/conf.default to /opt/bitnami/apache/conf
moodle_app  | moodle 21:19:43.53 INFO  ==> Configuring Apache ServerTokens directive
moodle_app  | moodle 21:19:43.53 DEBUG ==> Configuring ServerTokens Prod on file /opt/bitnami/apache/conf/httpd.conf
moodle_app  | moodle 21:19:43.55 INFO  ==> Configuring PHP options
moodle_app  | moodle 21:19:43.55 INFO  ==> Setting PHP expose_php option
moodle_app  | moodle 21:19:43.56 INFO  ==> Setting PHP max_execution_time option
moodle_app  | moodle 21:19:43.56 INFO  ==> Setting PHP memory_limit option
moodle_app  | moodle 21:19:43.57 INFO  ==> Setting PHP post_max_size option
moodle_app  | moodle 21:19:43.57 INFO  ==> Setting PHP upload_max_filesize option
moodle_app  | moodle 21:19:43.58 INFO  ==> Setting PHP output_buffering option
moodle_app  | moodle 21:19:43.59 INFO  ==> Validating settings in MYSQL_CLIENT_* env vars
moodle_app  | moodle 21:19:43.60 INFO  ==> Validating settings in POSTGRESQL_CLIENT_* env vars
moodle_app  | moodle 21:19:43.62 DEBUG ==> Validating settings in MOODLE_* environment variables...
moodle_app  | moodle 21:19:43.64 INFO  ==> Ensuring Moodle directories exist
moodle_app  | moodle 21:19:43.65 INFO  ==> Trying to connect to the database server
moodle_app  | /opt/bitnami/mysql/bin/mysql: Deprecated program name. It will be removed in a future release, use '/opt/bitnami/mysql/bin/mariadb' instead
moodle_app  | moodle 21:19:43.66 DEBUG ==> Executing SQL command:
moodle_app  | SELECT 1
moodle_app  | /opt/bitnami/mysql/bin/mysql: Deprecated program name. It will be removed in a future release, use '/opt/bitnami/mysql/bin/mariadb' instead
moodle_app  | 1
moodle_app  | moodle 21:19:43.71 INFO  ==> Running Moodle install script
moodle_app  | The configuration file config.php already exists. Please use admin/cli/install_database.php to install Moodle for this site.
moodle_app  | 
moodle_app exited with code 1
moodle_app  | moodle 21:19:45.53 DEBUG ==> Validating settings in APACHE_* environment variables
moodle_app  | moodle 21:19:45.54 DEBUG ==> Copying files from /opt/bitnami/apache/conf.default to /opt/bitnami/apache/conf
moodle_app  | moodle 21:19:45.55 INFO  ==> Configuring Apache ServerTokens directive
moodle_app  | moodle 21:19:45.55 DEBUG ==> Configuring ServerTokens Prod on file /opt/bitnami/apache/conf/httpd.conf
moodle_app  | moodle 21:19:45.56 INFO  ==> Configuring PHP options
moodle_app  | moodle 21:19:45.57 INFO  ==> Setting PHP expose_php option
moodle_app  | moodle 21:19:45.57 INFO  ==> Setting PHP max_execution_time option
moodle_app  | moodle 21:19:45.58 INFO  ==> Setting PHP memory_limit option
moodle_app  | moodle 21:19:45.58 INFO  ==> Setting PHP post_max_size option
moodle_app  | moodle 21:19:45.60 INFO  ==> Setting PHP upload_max_filesize option
moodle_app  | moodle 21:19:45.60 INFO  ==> Setting PHP output_buffering option
moodle_app  | moodle 21:19:45.62 INFO  ==> Validating settings in MYSQL_CLIENT_* env vars
moodle_app  | moodle 21:19:45.62 INFO  ==> Validating settings in POSTGRESQL_CLIENT_* env vars
moodle_app  | moodle 21:19:45.64 DEBUG ==> Validating settings in MOODLE_* environment variables...
moodle_app  | moodle 21:19:45.70 INFO  ==> Ensuring Moodle directories exist
moodle_app  | moodle 21:19:45.70 INFO  ==> Trying to connect to the database server
moodle_app  | /opt/bitnami/mysql/bin/mysql: Deprecated program name. It will be removed in a future release, use '/opt/bitnami/mysql/bin/mariadb' instead
moodle_app  | moodle 21:19:45.71 DEBUG ==> Executing SQL command:
moodle_app  | SELECT 1
moodle_app  | /opt/bitnami/mysql/bin/mysql: Deprecated program name. It will be removed in a future release, use '/opt/bitnami/mysql/bin/mariadb' instead
moodle_app  | 1
moodle_app  | moodle 21:19:45.75 INFO  ==> Running Moodle install script
moodle_app  | The configuration file config.php already exists. Please use admin/cli/install_database.php to install Moodle for this site.
moodle_app  | 
moodle_app exited with code 1
moodle_app  | moodle 21:19:49.17 DEBUG ==> Validating settings in APACHE_* environment variables
moodle_app  | moodle 21:19:49.18 DEBUG ==> Copying files from /opt/bitnami/apache/conf.default to /opt/bitnami/apache/conf
moodle_app  | moodle 21:19:49.19 INFO  ==> Configuring Apache ServerTokens directive
moodle_app  | moodle 21:19:49.19 DEBUG ==> Configuring ServerTokens Prod on file /opt/bitnami/apache/conf/httpd.conf
moodle_app  | moodle 21:19:49.21 INFO  ==> Configuring PHP options
moodle_app  | moodle 21:19:49.21 INFO  ==> Setting PHP expose_php option
moodle_app  | moodle 21:19:49.22 INFO  ==> Setting PHP max_execution_time option
moodle_app  | moodle 21:19:49.22 INFO  ==> Setting PHP memory_limit option
moodle_app  | moodle 21:19:49.23 INFO  ==> Setting PHP post_max_size option
moodle_app  | moodle 21:19:49.23 INFO  ==> Setting PHP upload_max_filesize option
moodle_app  | moodle 21:19:49.24 INFO  ==> Setting PHP output_buffering option
moodle_app  | moodle 21:19:49.25 INFO  ==> Validating settings in MYSQL_CLIENT_* env vars
moodle_app  | moodle 21:19:49.26 INFO  ==> Validating settings in POSTGRESQL_CLIENT_* env vars
moodle_app  | moodle 21:19:49.28 DEBUG ==> Validating settings in MOODLE_* environment variables...
moodle_app  | moodle 21:19:49.31 INFO  ==> Ensuring Moodle directories exist
moodle_app  | moodle 21:19:49.31 INFO  ==> Trying to connect to the database server
moodle_app  | /opt/bitnami/mysql/bin/mysql: Deprecated program name. It will be removed in a future release, use '/opt/bitnami/mysql/bin/mariadb' instead
moodle_app  | moodle 21:19:49.32 DEBUG ==> Executing SQL command:
moodle_app  | SELECT 1
moodle_app  | /opt/bitnami/mysql/bin/mysql: Deprecated program name. It will be removed in a future release, use '/opt/bitnami/mysql/bin/mariadb' instead
moodle_app  | 1
moodle_app  | moodle 21:19:49.36 INFO  ==> Running Moodle install script
moodle_app  | The configuration file config.php already exists. Please use admin/cli/install_database.php to install Moodle for this site.
moodle_app  | 
moodle_app exited with code 1
moodle_app  | moodle 21:19:55.97 DEBUG ==> Validating settings in APACHE_* environment variables
moodle_app  | moodle 21:19:55.97 DEBUG ==> Copying files from /opt/bitnami/apache/conf.default to /opt/bitnami/apache/conf
moodle_app  | moodle 21:19:55.98 INFO  ==> Configuring Apache ServerTokens directive
moodle_app  | moodle 21:19:55.98 DEBUG ==> Configuring ServerTokens Prod on file /opt/bitnami/apache/conf/httpd.conf
moodle_app  | moodle 21:19:56.01 INFO  ==> Configuring PHP options
moodle_app  | moodle 21:19:56.01 INFO  ==> Setting PHP expose_php option
moodle_app  | moodle 21:19:56.01 INFO  ==> Setting PHP max_execution_time option
moodle_app  | moodle 21:19:56.02 INFO  ==> Setting PHP memory_limit option
moodle_app  | moodle 21:19:56.03 INFO  ==> Setting PHP post_max_size option
moodle_app  | moodle 21:19:56.03 INFO  ==> Setting PHP upload_max_filesize option
moodle_app  | moodle 21:19:56.04 INFO  ==> Setting PHP output_buffering option
moodle_app  | moodle 21:19:56.05 INFO  ==> Validating settings in MYSQL_CLIENT_* env vars
moodle_app  | moodle 21:19:56.06 INFO  ==> Validating settings in POSTGRESQL_CLIENT_* env vars
moodle_app  | moodle 21:19:56.09 DEBUG ==> Validating settings in MOODLE_* environment variables...
moodle_app  | moodle 21:19:56.12 INFO  ==> Ensuring Moodle directories exist
moodle_app  | moodle 21:19:56.13 INFO  ==> Trying to connect to the database server
moodle_app  | /opt/bitnami/mysql/bin/mysql: Deprecated program name. It will be removed in a future release, use '/opt/bitnami/mysql/bin/mariadb' instead
moodle_app  | moodle 21:19:56.13 DEBUG ==> Executing SQL command:
moodle_app  | SELECT 1
moodle_app  | /opt/bitnami/mysql/bin/mysql: Deprecated program name. It will be removed in a future release, use '/opt/bitnami/mysql/bin/mariadb' instead
moodle_app  | 1
moodle_app  | moodle 21:19:56.17 INFO  ==> Running Moodle install script
moodle_app  | The configuration file config.php already exists. Please use admin/cli/install_database.php to install Moodle for this site.
moodle_app  | 
moodle_app exited with code 1
moodle_app  | moodle 21:20:09.19 DEBUG ==> Validating settings in APACHE_* environment variables
moodle_app  | moodle 21:20:09.19 DEBUG ==> Copying files from /opt/bitnami/apache/conf.default to /opt/bitnami/apache/conf
moodle_app  | moodle 21:20:09.20 INFO  ==> Configuring Apache ServerTokens directive
moodle_app  | moodle 21:20:09.20 DEBUG ==> Configuring ServerTokens Prod on file /opt/bitnami/apache/conf/httpd.conf
moodle_app  | moodle 21:20:09.22 INFO  ==> Configuring PHP options
moodle_app  | moodle 21:20:09.22 INFO  ==> Setting PHP expose_php option
moodle_app  | moodle 21:20:09.23 INFO  ==> Setting PHP max_execution_time option
moodle_app  | moodle 21:20:09.23 INFO  ==> Setting PHP memory_limit option
moodle_app  | moodle 21:20:09.24 INFO  ==> Setting PHP post_max_size option
moodle_app  | moodle 21:20:09.25 INFO  ==> Setting PHP upload_max_filesize option
moodle_app  | moodle 21:20:09.25 INFO  ==> Setting PHP output_buffering option
moodle_app  | moodle 21:20:09.26 INFO  ==> Validating settings in MYSQL_CLIENT_* env vars
moodle_app  | moodle 21:20:09.27 INFO  ==> Validating settings in POSTGRESQL_CLIENT_* env vars
moodle_app  | moodle 21:20:09.29 DEBUG ==> Validating settings in MOODLE_* environment variables...
moodle_app  | moodle 21:20:09.32 INFO  ==> Ensuring Moodle directories exist
moodle_app  | moodle 21:20:09.33 INFO  ==> Trying to connect to the database server
moodle_app  | /opt/bitnami/mysql/bin/mysql: Deprecated program name. It will be removed in a future release, use '/opt/bitnami/mysql/bin/mariadb' instead
moodle_app  | moodle 21:20:09.34 DEBUG ==> Executing SQL command:
moodle_app  | SELECT 1
moodle_app  | /opt/bitnami/mysql/bin/mysql: Deprecated program name. It will be removed in a future release, use '/opt/bitnami/mysql/bin/mariadb' instead
moodle_app  | 1
moodle_app  | moodle 21:20:09.38 INFO  ==> Running Moodle install script
moodle_app  | The configuration file config.php already exists. Please use admin/cli/install_database.php to install Moodle for this site.
moodle_app  | 
moodle_app exited with code 1
moodle_app  | moodle 21:20:35.18 DEBUG ==> Validating settings in APACHE_* environment variables
moodle_app  | moodle 21:20:35.19 DEBUG ==> Copying files from /opt/bitnami/apache/conf.default to /opt/bitnami/apache/conf
moodle_app  | moodle 21:20:35.19 INFO  ==> Configuring Apache ServerTokens directive
moodle_app  | moodle 21:20:35.19 DEBUG ==> Configuring ServerTokens Prod on file /opt/bitnami/apache/conf/httpd.conf
moodle_app  | moodle 21:20:35.21 INFO  ==> Configuring PHP options
moodle_app  | moodle 21:20:35.21 INFO  ==> Setting PHP expose_php option
moodle_app  | moodle 21:20:35.22 INFO  ==> Setting PHP max_execution_time option
moodle_app  | moodle 21:20:35.22 INFO  ==> Setting PHP memory_limit option
moodle_app  | moodle 21:20:35.23 INFO  ==> Setting PHP post_max_size option
moodle_app  | moodle 21:20:35.23 INFO  ==> Setting PHP upload_max_filesize option
moodle_app  | moodle 21:20:35.24 INFO  ==> Setting PHP output_buffering option
moodle_app  | moodle 21:20:35.25 INFO  ==> Validating settings in MYSQL_CLIENT_* env vars
moodle_app  | moodle 21:20:35.25 INFO  ==> Validating settings in POSTGRESQL_CLIENT_* env vars
moodle_app  | moodle 21:20:35.27 DEBUG ==> Validating settings in MOODLE_* environment variables...
moodle_app  | moodle 21:20:35.30 INFO  ==> Ensuring Moodle directories exist
moodle_app  | moodle 21:20:35.31 INFO  ==> Trying to connect to the database server
moodle_app  | /opt/bitnami/mysql/bin/mysql: Deprecated program name. It will be removed in a future release, use '/opt/bitnami/mysql/bin/mariadb' instead
moodle_app  | moodle 21:20:35.31 DEBUG ==> Executing SQL command:
moodle_app  | SELECT 1
moodle_app  | /opt/bitnami/mysql/bin/mysql: Deprecated program name. It will be removed in a future release, use '/opt/bitnami/mysql/bin/mariadb' instead
moodle_app  | 1
moodle_app  | moodle 21:20:35.35 INFO  ==> Running Moodle install script
moodle_app  | The configuration file config.php already exists. Please use admin/cli/install_database.php to install Moodle for this site.
moodle_app  | 
moodle_app exited with code 1
moodle_app  | moodle 21:21:26.76 DEBUG ==> Validating settings in APACHE_* environment variables
moodle_app  | moodle 21:21:26.77 DEBUG ==> Copying files from /opt/bitnami/apache/conf.default to /opt/bitnami/apache/conf
moodle_app  | moodle 21:21:26.77 INFO  ==> Configuring Apache ServerTokens directive
moodle_app  | moodle 21:21:26.78 DEBUG ==> Configuring ServerTokens Prod on file /opt/bitnami/apache/conf/httpd.conf
moodle_app  | moodle 21:21:26.80 INFO  ==> Configuring PHP options
moodle_app  | moodle 21:21:26.80 INFO  ==> Setting PHP expose_php option
moodle_app  | moodle 21:21:26.81 INFO  ==> Setting PHP max_execution_time option
moodle_app  | moodle 21:21:26.82 INFO  ==> Setting PHP memory_limit option
moodle_app  | moodle 21:21:26.82 INFO  ==> Setting PHP post_max_size option
moodle_app  | moodle 21:21:26.83 INFO  ==> Setting PHP upload_max_filesize option
moodle_app  | moodle 21:21:26.83 INFO  ==> Setting PHP output_buffering option
moodle_app  | moodle 21:21:26.85 INFO  ==> Validating settings in MYSQL_CLIENT_* env vars
moodle_app  | moodle 21:21:26.85 INFO  ==> Validating settings in POSTGRESQL_CLIENT_* env vars
moodle_app  | moodle 21:21:26.87 DEBUG ==> Validating settings in MOODLE_* environment variables...
moodle_app  | moodle 21:21:26.90 INFO  ==> Ensuring Moodle directories exist
moodle_app  | moodle 21:21:26.91 INFO  ==> Trying to connect to the database server
moodle_app  | /opt/bitnami/mysql/bin/mysql: Deprecated program name. It will be removed in a future release, use '/opt/bitnami/mysql/bin/mariadb' instead
moodle_app  | moodle 21:21:26.92 DEBUG ==> Executing SQL command:
moodle_app  | SELECT 1
moodle_app  | /opt/bitnami/mysql/bin/mysql: Deprecated program name. It will be removed in a future release, use '/opt/bitnami/mysql/bin/mariadb' instead
moodle_app  | 1
moodle_app  | moodle 21:21:26.95 INFO  ==> Running Moodle install script
moodle_app  | The configuration file config.php already exists. Please use admin/cli/install_database.php to install Moodle for this site.
moodle_app  | 
moodle_app exited with code 1
moodle_app  | moodle 21:22:27.16 DEBUG ==> Validating settings in APACHE_* environment variables
moodle_app  | moodle 21:22:27.17 DEBUG ==> Copying files from /opt/bitnami/apache/conf.default to /opt/bitnami/apache/conf
moodle_app  | moodle 21:22:27.18 INFO  ==> Configuring Apache ServerTokens directive
moodle_app  | moodle 21:22:27.18 DEBUG ==> Configuring ServerTokens Prod on file /opt/bitnami/apache/conf/httpd.conf
moodle_app  | moodle 21:22:27.19 INFO  ==> Configuring PHP options
moodle_app  | moodle 21:22:27.20 INFO  ==> Setting PHP expose_php option
moodle_app  | moodle 21:22:27.21 INFO  ==> Setting PHP max_execution_time option
moodle_app  | moodle 21:22:27.21 INFO  ==> Setting PHP memory_limit option
moodle_app  | moodle 21:22:27.22 INFO  ==> Setting PHP post_max_size option
moodle_app  | moodle 21:22:27.22 INFO  ==> Setting PHP upload_max_filesize option
moodle_app  | moodle 21:22:27.23 INFO  ==> Setting PHP output_buffering option
moodle_app  | moodle 21:22:27.24 INFO  ==> Validating settings in MYSQL_CLIENT_* env vars
moodle_app  | moodle 21:22:27.25 INFO  ==> Validating settings in POSTGRESQL_CLIENT_* env vars
moodle_app  | moodle 21:22:27.27 DEBUG ==> Validating settings in MOODLE_* environment variables...
moodle_app  | moodle 21:22:27.30 INFO  ==> Ensuring Moodle directories exist
moodle_app  | moodle 21:22:27.31 INFO  ==> Trying to connect to the database server
moodle_app  | /opt/bitnami/mysql/bin/mysql: Deprecated program name. It will be removed in a future release, use '/opt/bitnami/mysql/bin/mariadb' instead
moodle_app  | moodle 21:22:27.31 DEBUG ==> Executing SQL command:
moodle_app  | SELECT 1
moodle_app  | /opt/bitnami/mysql/bin/mysql: Deprecated program name. It will be removed in a future release, use '/opt/bitnami/mysql/bin/mariadb' instead
moodle_app  | 1
moodle_app  | moodle 21:22:27.36 INFO  ==> Running Moodle install script
moodle_app  | The configuration file config.php already exists. Please use admin/cli/install_database.php to install Moodle for this site.
moodle_app  | 
moodle_app exited with code 1
moodle_app  | moodle 21:23:27.58 DEBUG ==> Validating settings in APACHE_* environment variables
moodle_app  | moodle 21:23:27.58 DEBUG ==> Copying files from /opt/bitnami/apache/conf.default to /opt/bitnami/apache/conf
moodle_app  | moodle 21:23:27.59 INFO  ==> Configuring Apache ServerTokens directive
moodle_app  | moodle 21:23:27.59 DEBUG ==> Configuring ServerTokens Prod on file /opt/bitnami/apache/conf/httpd.conf
moodle_app  | moodle 21:23:27.61 INFO  ==> Configuring PHP options
moodle_app  | moodle 21:23:27.61 INFO  ==> Setting PHP expose_php option
moodle_app  | moodle 21:23:27.61 INFO  ==> Setting PHP max_execution_time option
moodle_app  | moodle 21:23:27.63 INFO  ==> Setting PHP memory_limit option
moodle_app  | moodle 21:23:27.63 INFO  ==> Setting PHP post_max_size option
moodle_app  | moodle 21:23:27.64 INFO  ==> Setting PHP upload_max_filesize option
moodle_app  | moodle 21:23:27.64 INFO  ==> Setting PHP output_buffering option
moodle_app  | moodle 21:23:27.66 INFO  ==> Validating settings in MYSQL_CLIENT_* env vars
moodle_app  | moodle 21:23:27.66 INFO  ==> Validating settings in POSTGRESQL_CLIENT_* env vars
moodle_app  | moodle 21:23:27.68 DEBUG ==> Validating settings in MOODLE_* environment variables...
moodle_app  | moodle 21:23:27.70 INFO  ==> Ensuring Moodle directories exist
moodle_app  | moodle 21:23:27.71 INFO  ==> Trying to connect to the database server
moodle_app  | /opt/bitnami/mysql/bin/mysql: Deprecated program name. It will be removed in a future release, use '/opt/bitnami/mysql/bin/mariadb' instead
moodle_app  | moodle 21:23:27.72 DEBUG ==> Executing SQL command:
moodle_app  | SELECT 1
moodle_app  | /opt/bitnami/mysql/bin/mysql: Deprecated program name. It will be removed in a future release, use '/opt/bitnami/mysql/bin/mariadb' instead
moodle_app  | 1
moodle_app  | moodle 21:23:27.76 INFO  ==> Running Moodle install script
moodle_app  | The configuration file config.php already exists. Please use admin/cli/install_database.php to install Moodle for this site.
moodle_app  | 
moodle_app exited with code 1
moodle_app  | moodle 21:24:28.04 DEBUG ==> Validating settings in APACHE_* environment variables
moodle_app  | moodle 21:24:28.05 DEBUG ==> Copying files from /opt/bitnami/apache/conf.default to /opt/bitnami/apache/conf
moodle_app  | moodle 21:24:28.05 INFO  ==> Configuring Apache ServerTokens directive
moodle_app  | moodle 21:24:28.05 DEBUG ==> Configuring ServerTokens Prod on file /opt/bitnami/apache/conf/httpd.conf
moodle_app  | moodle 21:24:28.08 INFO  ==> Configuring PHP options
moodle_app  | moodle 21:24:28.08 INFO  ==> Setting PHP expose_php option
moodle_app  | moodle 21:24:28.09 INFO  ==> Setting PHP max_execution_time option
moodle_app  | moodle 21:24:28.09 INFO  ==> Setting PHP memory_limit option
moodle_app  | moodle 21:24:28.10 INFO  ==> Setting PHP post_max_size option
moodle_app  | moodle 21:24:28.11 INFO  ==> Setting PHP upload_max_filesize option
moodle_app  | moodle 21:24:28.11 INFO  ==> Setting PHP output_buffering option
moodle_app  | moodle 21:24:28.13 INFO  ==> Validating settings in MYSQL_CLIENT_* env vars
moodle_app  | moodle 21:24:28.14 INFO  ==> Validating settings in POSTGRESQL_CLIENT_* env vars
moodle_app  | moodle 21:24:28.16 DEBUG ==> Validating settings in MOODLE_* environment variables...
moodle_app  | moodle 21:24:28.19 INFO  ==> Ensuring Moodle directories exist
moodle_app  | moodle 21:24:28.20 INFO  ==> Trying to connect to the database server
moodle_app  | /opt/bitnami/mysql/bin/mysql: Deprecated program name. It will be removed in a future release, use '/opt/bitnami/mysql/bin/mariadb' instead
moodle_app  | moodle 21:24:28.21 DEBUG ==> Executing SQL command:
moodle_app  | SELECT 1
moodle_app  | /opt/bitnami/mysql/bin/mysql: Deprecated program name. It will be removed in a future release, use '/opt/bitnami/mysql/bin/mariadb' instead
moodle_app  | 1
moodle_app  | moodle 21:24:28.26 INFO  ==> Running Moodle install script
moodle_app  | The configuration file config.php already exists. Please use admin/cli/install_database.php to install Moodle for this site.
moodle_app  | 
moodle_app exited with code 1

v View in Docker Desktop   o View Config   w Enable Watch

/fix

---

Letâ€™s analyze the issues in your Docker Compose setup and logs, then provide a step-by-step fix for the Moodle installation problems you're encountering.
Identified Issues
Obsolete version Attribute: The version: '3' in your docker-compose.yml is obsolete in newer versions of Docker Compose. Itâ€™s safe to remove it as the latest Compose versions automatically use the appropriate schema.
Database Type Mismatch: The Moodle setup fails with:
[System] must be installed and enabled - Wrong $CFG->dbtype. You need to change it in your config.php file from 'mysqli' to 'mariadb'.
This happens because you're using MariaDB (version 10.6), but Moodleâ€™s configuration is set to mysqli. Moodle needs to know itâ€™s connecting to MariaDB explicitly.
Config File Already Exists: After the initial failure, subsequent restarts fail with:
The configuration file config.php already exists. Please use admin/cli/install_database.php to install Moodle for this site.
This indicates that Moodle generated a config.php file during the first run but didnâ€™t complete the database installation, leaving the setup in an incomplete state.
Restart Loop: The moodle_app container keeps restarting (exited with code 1) because the setup script fails and doesnâ€™t proceed to run the web server.
Root Cause
The environment variable MOODLE_DATABASE_TYPE: mysqli in your docker-compose.yml is incorrect for MariaDB. It should be mariadb.
The initial failure creates a partial config.php, and the Bitnami imageâ€™s entrypoint script doesnâ€™t handle this gracefully on restart, requiring manual intervention to complete the database installation.
Fix Steps
Hereâ€™s how to resolve the issues and get Moodle running:
1. Update docker-compose.yml
Update the MOODLE_DATABASE_TYPE to mariadb and remove the obsolete version attribute. Hereâ€™s the corrected file:
yaml
services:
  moodle:
    image: my-moodle:latest
    container_name: moodle_app
    restart: always
    ports:
      - "80:80"
    environment:
      MOODLE_DATABASE_TYPE: mariadb  # Changed from mysqli to mariadb
      MOODLE_DATABASE_HOST: db
      MOODLE_DATABASE_PORT_NUMBER: 3306
      MOODLE_DATABASE_NAME: moodle
      MOODLE_DATABASE_USER: moodle
      MOODLE_DATABASE_PASSWORD: "SafeP@ssw0rd-123"
      MOODLE_USERNAME: admin
      MOODLE_PASSWORD: "SecureAdminP@ssw0rd456"
      MOODLE_EMAIL: contact@rifaterdemsahin.com
      MOODLE_SITE_NAME: "Moodle LMS"
      MOODLE_HOST: "localhost"
      PHP_MAX_EXECUTION_TIME: 300
      PHP_MEMORY_LIMIT: 256M
      PHP_POST_MAX_SIZE: 50M
      PHP_UPLOAD_MAX_FILESIZE: 50M
      BITNAMI_DEBUG: "true"
    volumes:
      - moodle_data:/bitnami/moodle
      - moodledata_data:/bitnami/moodledata
    depends_on:
      - db
    networks:
      - moodle-net

  db:
    image: mariadb:10.6
    container_name: moodle_db
    restart: always
    environment:
      MYSQL_DATABASE: moodle
      MYSQL_USER: moodle
      MYSQL_PASSWORD: "SafeP@ssw0rd-123"
      MYSQL_ROOT_PASSWORD: "RootP@ssw0rd789"
    volumes:
      - db_data:/var/lib/mysql
    networks:
      - moodle-net
    command: --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci

volumes:
  moodle_data:
  moodledata_data:
  db_data:

networks:
  moodle-net:
    driver: bridge
2. Stop and Remove Existing Containers and Volumes
Since the setup is in a broken state (partial config.php and no database tables), you need to start fresh:
bash
docker-compose down -v
This removes the containers, networks, and volumes (including the persistent data containing the broken config.php).
3. Restart the Services
Bring the services back up with the updated configuration:
bash
docker-compose up --force-recreate
The --force-recreate ensures new containers are created with the updated settings.
4. Verify Logs
Check the logs to ensure Moodle installs correctly:
bash
docker-compose logs -f
You should see the database initializing, followed by Moodle completing its installation without the mysqli error. The logs should end with Apache starting up (e.g., "Starting Apache...") rather than exiting.
5. Access Moodle
Once the setup completes, open your browser and go to http://localhost. Log in with:
Username: admin
Password: SecureAdminP@ssw0rd456
Additional Troubleshooting (If Needed)
If the setup still fails:
Check config.php: Exec into the moodle_app container and inspect /bitnami/moodle/config.php:
bash
docker exec -it moodle_app bash
cat /bitnami/moodle/config.php
Ensure $CFG->dbtype = 'mariadb'; is set. If not, the environment variable might not be applied correctly.
Manually Install Database: If the automatic install fails again, you can manually trigger the database installation:
bash
docker exec -it moodle_app bash
php /bitnami/moodle/admin/cli/install_database.php
This should complete the database setup based on the existing config.php.
Volume Permissions: Ensure your local user has write permissions to the volume directories if youâ€™re mounting them locally.
Why This Works
Changing MOODLE_DATABASE_TYPE to mariadb aligns the configuration with the MariaDB database.
Clearing the volumes removes the broken config.php and allows a fresh install.
The Bitnami Moodle imageâ€™s entrypoint script will handle the rest once the configuration is correct.
Let me know if you encounter any further issues!

---

rifaterdemsahin@MacBookPro 3_local % docker-compose logs -f
WARN[0000] /Users/rifaterdemsahin/projects/Moodle/6_ðŸ”£_Symbols/3_local/docker-compose.yml: the attribute `version` is obsolete, it will be ignored, please remove it to avoid potential confusion 
moodle_db  | 2025-03-16 21:19:33+00:00 [Note] [Entrypoint]: Entrypoint script for MariaDB Server 1:10.6.21+maria~ubu2004 started.
moodle_db  | 2025-03-16 21:19:33+00:00 [Note] [Entrypoint]: Switching to dedicated user 'mysql'
moodle_db  | 2025-03-16 21:19:33+00:00 [Note] [Entrypoint]: Entrypoint script for MariaDB Server 1:10.6.21+maria~ubu2004 started.
moodle_db  | 2025-03-16 21:19:33+00:00 [Note] [Entrypoint]: Initializing database files
moodle_db  | 2025-03-16 21:19:34+00:00 [Note] [Entrypoint]: Database files initialized
moodle_db  | 2025-03-16 21:19:34+00:00 [Note] [Entrypoint]: Starting temporary server
moodle_db  | 2025-03-16 21:19:34+00:00 [Note] [Entrypoint]: Waiting for server startup
moodle_db  | 2025-03-16 21:19:34 0 [Note] Starting MariaDB 10.6.21-MariaDB-ubu2004 source revision 066e8d6aeabc13242193780341e0f845528105de server_uid 72+4ASMvYxproTQgRqIDplDA1XA= as process 100
moodle_db  | 2025-03-16 21:19:34 0 [Note] InnoDB: Compressed tables use zlib 1.2.11
moodle_db  | 2025-03-16 21:19:34 0 [Note] InnoDB: Number of pools: 1
moodle_db  | 2025-03-16 21:19:34 0 [Note] InnoDB: Using ARMv8 crc32 + pmull instructions
moodle_db  | 2025-03-16 21:19:34 0 [Note] InnoDB: Using Linux native AIO
moodle_db  | 2025-03-16 21:19:34 0 [Note] InnoDB: Initializing buffer pool, total size = 134217728, chunk size = 134217728
moodle_db  | 2025-03-16 21:19:34 0 [Note] InnoDB: Completed initialization of buffer pool
moodle_db  | 2025-03-16 21:19:34 0 [Note] InnoDB: 128 rollback segments are active.
moodle_db  | 2025-03-16 21:19:34 0 [Note] InnoDB: Creating shared tablespace for temporary tables
moodle_db  | 2025-03-16 21:19:34 0 [Note] InnoDB: Setting file './ibtmp1' size to 12 MB. Physically writing the file full; Please wait ...
moodle_db  | 2025-03-16 21:19:34 0 [Note] InnoDB: File './ibtmp1' size is now 12 MB.
moodle_db  | 2025-03-16 21:19:34 0 [Note] InnoDB: 10.6.21 started; log sequence number 41354; transaction id 14
moodle_db  | 2025-03-16 21:19:34 0 [Note] Plugin 'FEEDBACK' is disabled.
moodle_db  | 2025-03-16 21:19:34 0 [Note] mariadbd: ready for connections.
moodle_db  | Version: '10.6.21-MariaDB-ubu2004'  socket: '/run/mysqld/mysqld.sock'  port: 0  mariadb.org binary distribution
moodle_db  | 2025-03-16 21:19:35+00:00 [Note] [Entrypoint]: Temporary server started.
moodle_db  | 2025-03-16 21:19:36+00:00 [Note] [Entrypoint]: Creating database moodle
moodle_db  | 2025-03-16 21:19:36+00:00 [Note] [Entrypoint]: Creating user moodle
moodle_db  | 2025-03-16 21:19:36+00:00 [Note] [Entrypoint]: Giving user moodle access to schema moodle
moodle_db  | 2025-03-16 21:19:36+00:00 [Note] [Entrypoint]: Securing system users (equivalent to running mysql_secure_installation)
moodle_db  | 
moodle_db  | 2025-03-16 21:19:36+00:00 [Note] [Entrypoint]: Stopping temporary server
moodle_db  | 2025-03-16 21:19:36 0 [Note] mariadbd (initiated by: unknown): Normal shutdown
moodle_db  | 2025-03-16 21:19:36 0 [Note] InnoDB: FTS optimize thread exiting.
moodle_db  | 2025-03-16 21:19:36 0 [Note] InnoDB: Starting shutdown...
moodle_db  | 2025-03-16 21:19:36 0 [Note] InnoDB: Dumping buffer pool(s) to /var/lib/mysql/ib_buffer_pool
moodle_db  | 2025-03-16 21:19:36 0 [Note] InnoDB: Buffer pool(s) dump completed at 250316 21:19:36
moodle_db  | 2025-03-16 21:19:36 0 [Note] InnoDB: Removed temporary tablespace data file: "./ibtmp1"
moodle_db  | 2025-03-16 21:19:36 0 [Note] InnoDB: Shutdown completed; log sequence number 42664; transaction id 15
moodle_db  | 2025-03-16 21:19:36 0 [Note] mariadbd: Shutdown complete
moodle_db  | 2025-03-16 21:19:36+00:00 [Note] [Entrypoint]: Temporary server stopped
moodle_db  | 
moodle_db  | 2025-03-16 21:19:36+00:00 [Note] [Entrypoint]: MariaDB init process done. Ready for start up.
moodle_db  | 
moodle_db  | 2025-03-16 21:19:36 0 [Note] Starting MariaDB 10.6.21-MariaDB-ubu2004 source revision 066e8d6aeabc13242193780341e0f845528105de server_uid 72+4ASMvYxproTQgRqIDplDA1XA= as process 1
moodle_db  | 2025-03-16 21:19:36 0 [Note] InnoDB: Compressed tables use zlib 1.2.11
moodle_db  | 2025-03-16 21:19:36 0 [Note] InnoDB: Number of pools: 1
moodle_db  | 2025-03-16 21:19:36 0 [Note] InnoDB: Using ARMv8 crc32 + pmull instructions
moodle_db  | 2025-03-16 21:19:36 0 [Note] InnoDB: Using Linux native AIO
moodle_db  | 2025-03-16 21:19:36 0 [Note] InnoDB: Initializing buffer pool, total size = 134217728, chunk size = 134217728
moodle_db  | 2025-03-16 21:19:36 0 [Note] InnoDB: Completed initialization of buffer pool
moodle_db  | 2025-03-16 21:19:36 0 [Note] InnoDB: 128 rollback segments are active.
moodle_db  | 2025-03-16 21:19:36 0 [Note] InnoDB: Creating shared tablespace for temporary tables
moodle_db  | 2025-03-16 21:19:36 0 [Note] InnoDB: Setting file './ibtmp1' size to 12 MB. Physically writing the file full; Please wait ...
moodle_db  | 2025-03-16 21:19:36 0 [Note] InnoDB: File './ibtmp1' size is now 12 MB.
moodle_db  | 2025-03-16 21:19:36 0 [Note] InnoDB: 10.6.21 started; log sequence number 42664; transaction id 15
moodle_db  | 2025-03-16 21:19:36 0 [Note] InnoDB: Loading buffer pool(s) from /var/lib/mysql/ib_buffer_pool
moodle_db  | 2025-03-16 21:19:36 0 [Note] Plugin 'FEEDBACK' is disabled.
moodle_db  | 2025-03-16 21:19:36 0 [Note] InnoDB: Buffer pool(s) load completed at 250316 21:19:36
moodle_db  | 2025-03-16 21:19:36 0 [Warning] You need to use --log-bin to make --expire-logs-days or --binlog-expire-logs-seconds work.
moodle_db  | 2025-03-16 21:19:36 0 [Note] Server socket created on IP: '0.0.0.0'.
moodle_db  | 2025-03-16 21:19:36 0 [Note] Server socket created on IP: '::'.
moodle_db  | 2025-03-16 21:19:36 0 [Note] mariadbd: ready for connections.
moodle_db  | Version: '10.6.21-MariaDB-ubu2004'  socket: '/run/mysqld/mysqld.sock'  port: 3306  mariadb.org binary distribution
moodle_db  | 2025-03-16 21:27:23 0 [Note] mariadbd (initiated by: unknown): Normal shutdown
moodle_db  | 2025-03-16 21:27:23 0 [Note] InnoDB: FTS optimize thread exiting.
moodle_db  | 2025-03-16 21:27:23 0 [Note] InnoDB: Starting shutdown...
moodle_db  | 2025-03-16 21:27:23 0 [Note] InnoDB: Dumping buffer pool(s) to /var/lib/mysql/ib_buffer_pool
moodle_db  | 2025-03-16 21:27:23 0 [Note] InnoDB: Buffer pool(s) dump completed at 250316 21:27:23
moodle_db  | 2025-03-16 21:27:24 0 [Note] InnoDB: Removed temporary tablespace data file: "./ibtmp1"
moodle_db  | 2025-03-16 21:27:24 0 [Note] InnoDB: Shutdown completed; log sequence number 42676; transaction id 16
moodle_db  | 2025-03-16 21:27:24 0 [Note] mariadbd: Shutdown complete
moodle_app  | moodle 21:19:33.46 INFO  ==> 
moodle_app  | moodle 21:19:33.46 INFO  ==> Welcome to the Bitnami moodle container
moodle_app  | moodle 21:19:33.46 INFO  ==> Subscribe to project updates by watching https://github.com/bitnami/containers
moodle_app  | moodle 21:19:33.46 INFO  ==> Did you know there are enterprise versions of the Bitnami catalog? For enhanced secure software supply chain features, unlimited pulls from Docker, LTS support, or application customization, see Bitnami Premium or Tanzu Application Catalog. See https://www.arrow.com/globalecs/na/vendors/bitnami/ for more information.
moodle_app  | moodle 21:19:33.46 INFO  ==> 
moodle_app  | moodle 21:19:33.46 INFO  ==> ** Starting Moodle setup **
moodle_app  | moodle 21:19:33.47 DEBUG ==> Validating settings in APACHE_* environment variables
moodle_app  | moodle 21:19:33.48 DEBUG ==> Copying files from /opt/bitnami/apache/conf.default to /opt/bitnami/apache/conf
moodle_app  | moodle 21:19:33.49 INFO  ==> Generating sample certificates
moodle_app  | Certificate request self-signature ok
moodle_app  | subject=CN = example.com
moodle_app  | moodle 21:19:34.89 INFO  ==> Configuring Apache ServerTokens directive
moodle_app  | moodle 21:19:34.89 DEBUG ==> Configuring ServerTokens Prod on file /opt/bitnami/apache/conf/httpd.conf
moodle_app  | moodle 21:19:34.90 INFO  ==> Configuring PHP options
moodle_app  | moodle 21:19:34.91 INFO  ==> Setting PHP expose_php option
moodle_app  | moodle 21:19:34.91 INFO  ==> Setting PHP max_execution_time option
moodle_app  | moodle 21:19:34.92 INFO  ==> Setting PHP memory_limit option
moodle_app  | moodle 21:19:34.92 INFO  ==> Setting PHP post_max_size option
moodle_app  | moodle 21:19:34.93 INFO  ==> Setting PHP upload_max_filesize option
moodle_app  | moodle 21:19:34.93 INFO  ==> Setting PHP output_buffering option
moodle_app  | moodle 21:19:34.95 INFO  ==> Validating settings in MYSQL_CLIENT_* env vars
moodle_app  | moodle 21:19:34.95 INFO  ==> Validating settings in POSTGRESQL_CLIENT_* env vars
moodle_app  | moodle 21:19:34.97 DEBUG ==> Validating settings in MOODLE_* environment variables...
moodle_app  | moodle 21:19:35.00 INFO  ==> Ensuring Moodle directories exist
moodle_app  | moodle 21:19:35.01 INFO  ==> Trying to connect to the database server
moodle_app  | /opt/bitnami/mysql/bin/mysql: Deprecated program name. It will be removed in a future release, use '/opt/bitnami/mysql/bin/mariadb' instead
moodle_app  | moodle 21:19:35.02 DEBUG ==> Executing SQL command:
moodle_app  | SELECT 1
moodle_app  | /opt/bitnami/mysql/bin/mysql: Deprecated program name. It will be removed in a future release, use '/opt/bitnami/mysql/bin/mariadb' instead
moodle_app  | ERROR 2002 (HY000): Can't connect to server on 'db' (115)
moodle_app  | /opt/bitnami/mysql/bin/mysql: Deprecated program name. It will be removed in a future release, use '/opt/bitnami/mysql/bin/mariadb' instead
moodle_app  | moodle 21:19:40.05 DEBUG ==> Executing SQL command:
moodle_app  | SELECT 1
moodle_app  | /opt/bitnami/mysql/bin/mysql: Deprecated program name. It will be removed in a future release, use '/opt/bitnami/mysql/bin/mariadb' instead
moodle_app  | 1
moodle_app  | moodle 21:19:40.10 INFO  ==> Running Moodle install script
moodle_app  |                                  .-..-.       
moodle_app  |    _____                         | || |       
moodle_app  |   /____/-.---_  .---.  .---.  .-.| || | .---. 
moodle_app  |   | |  _   _  |/  _  \/  _  \/  _  || |/  __ \
moodle_app  |   * | | | | | || |_| || |_| || |_| || || |___/
moodle_app  |     |_| |_| |_|\_____/\_____/\_____||_|\_____)
moodle_app  | 
moodle_app  | Moodle 4.5.2 (Build: 20250210) command line installation program
moodle_app  | == Environment ==
moodle_app  | !! database mysql (10.6.21-MariaDB-ubu2004) !!
moodle_app  | [System] must be installed and enabled - Wrong $CFG->dbtype. You need to change it in your config.php file from
moodle_app  | 'mysqli' to 'mariadb'.
moodle_app  | 
moodle_app  | 
moodle_app  | moodle 21:19:40.71 INFO  ==> 
moodle_app  | moodle 21:19:40.71 INFO  ==> Welcome to the Bitnami moodle container
moodle_app  | moodle 21:19:40.71 INFO  ==> Subscribe to project updates by watching https://github.com/bitnami/containers
moodle_app  | moodle 21:19:40.71 INFO  ==> Did you know there are enterprise versions of the Bitnami catalog? For enhanced secure software supply chain features, unlimited pulls from Docker, LTS support, or application customization, see Bitnami Premium or Tanzu Application Catalog. See https://www.arrow.com/globalecs/na/vendors/bitnami/ for more information.
moodle_app  | moodle 21:19:40.71 INFO  ==> 
moodle_app  | moodle 21:19:40.71 INFO  ==> ** Starting Moodle setup **
moodle_app  | moodle 21:19:40.72 DEBUG ==> Validating settings in APACHE_* environment variables
moodle_app  | moodle 21:19:40.72 DEBUG ==> Copying files from /opt/bitnami/apache/conf.default to /opt/bitnami/apache/conf
moodle_app  | moodle 21:19:40.73 INFO  ==> Configuring Apache ServerTokens directive
moodle_app  | moodle 21:19:40.73 DEBUG ==> Configuring ServerTokens Prod on file /opt/bitnami/apache/conf/httpd.conf
moodle_app  | moodle 21:19:40.75 INFO  ==> Configuring PHP options
moodle_app  | moodle 21:19:40.76 INFO  ==> Setting PHP expose_php option
moodle_app  | moodle 21:19:40.76 INFO  ==> Setting PHP max_execution_time option
moodle_app  | moodle 21:19:40.77 INFO  ==> Setting PHP memory_limit option
moodle_app  | moodle 21:19:40.77 INFO  ==> Setting PHP post_max_size option
moodle_app  | moodle 21:19:40.78 INFO  ==> Setting PHP upload_max_filesize option
moodle_app  | moodle 21:19:40.78 INFO  ==> Setting PHP output_buffering option
moodle_app  | moodle 21:19:40.80 INFO  ==> Validating settings in MYSQL_CLIENT_* env vars
moodle_app  | moodle 21:19:40.80 INFO  ==> Validating settings in POSTGRESQL_CLIENT_* env vars
moodle_app  | moodle 21:19:40.82 DEBUG ==> Validating settings in MOODLE_* environment variables...
moodle_app  | moodle 21:19:40.85 INFO  ==> Ensuring Moodle directories exist
moodle_app  | moodle 21:19:40.86 INFO  ==> Trying to connect to the database server
moodle_app  | /opt/bitnami/mysql/bin/mysql: Deprecated program name. It will be removed in a future release, use '/opt/bitnami/mysql/bin/mariadb' instead
moodle_app  | moodle 21:19:40.87 DEBUG ==> Executing SQL command:
moodle_app  | SELECT 1
moodle_app  | /opt/bitnami/mysql/bin/mysql: Deprecated program name. It will be removed in a future release, use '/opt/bitnami/mysql/bin/mariadb' instead
moodle_app  | 1
moodle_app  | moodle 21:19:40.90 INFO  ==> Running Moodle install script
moodle_app  | The configuration file config.php already exists. Please use admin/cli/install_database.php to install Moodle for this site.
moodle_app  | 
moodle_app  | moodle 21:19:41.53 INFO  ==> 
moodle_app  | moodle 21:19:41.53 INFO  ==> Welcome to the Bitnami moodle container
moodle_app  | moodle 21:19:41.53 INFO  ==> Subscribe to project updates by watching https://github.com/bitnami/containers
moodle_app  | moodle 21:19:41.53 INFO  ==> Did you know there are enterprise versions of the Bitnami catalog? For enhanced secure software supply chain features, unlimited pulls from Docker, LTS support, or application customization, see Bitnami Premium or Tanzu Application Catalog. See https://www.arrow.com/globalecs/na/vendors/bitnami/ for more information.
moodle_app  | moodle 21:19:41.53 INFO  ==> 
moodle_app  | moodle 21:19:41.53 INFO  ==> ** Starting Moodle setup **
moodle_app  | moodle 21:19:41.54 DEBUG ==> Validating settings in APACHE_* environment variables
moodle_app  | moodle 21:19:41.55 DEBUG ==> Copying files from /opt/bitnami/apache/conf.default to /opt/bitnami/apache/conf
moodle_app  | moodle 21:19:41.56 INFO  ==> Configuring Apache ServerTokens directive
moodle_app  | moodle 21:19:41.56 DEBUG ==> Configuring ServerTokens Prod on file /opt/bitnami/apache/conf/httpd.conf
moodle_app  | moodle 21:19:41.57 INFO  ==> Configuring PHP options
moodle_app  | moodle 21:19:41.58 INFO  ==> Setting PHP expose_php option
moodle_app  | moodle 21:19:41.58 INFO  ==> Setting PHP max_execution_time option
moodle_app  | moodle 21:19:41.59 INFO  ==> Setting PHP memory_limit option
moodle_app  | moodle 21:19:41.59 INFO  ==> Setting PHP post_max_size option
moodle_app  | moodle 21:19:41.60 INFO  ==> Setting PHP upload_max_filesize option
moodle_app  | moodle 21:19:41.60 INFO  ==> Setting PHP output_buffering option
moodle_app  | moodle 21:19:41.62 INFO  ==> Validating settings in MYSQL_CLIENT_* env vars
moodle_app  | moodle 21:19:41.62 INFO  ==> Validating settings in POSTGRESQL_CLIENT_* env vars
moodle_app  | moodle 21:19:41.64 DEBUG ==> Validating settings in MOODLE_* environment variables...
moodle_app  | moodle 21:19:41.67 INFO  ==> Ensuring Moodle directories exist
moodle_app  | moodle 21:19:41.68 INFO  ==> Trying to connect to the database server
moodle_app  | /opt/bitnami/mysql/bin/mysql: Deprecated program name. It will be removed in a future release, use '/opt/bitnami/mysql/bin/mariadb' instead
moodle_app  | moodle 21:19:41.68 DEBUG ==> Executing SQL command:
moodle_app  | SELECT 1
moodle_app  | /opt/bitnami/mysql/bin/mysql: Deprecated program name. It will be removed in a future release, use '/opt/bitnami/mysql/bin/mariadb' instead
moodle_app  | 1
moodle_app  | moodle 21:19:41.72 INFO  ==> Running Moodle install script
moodle_app  | The configuration file config.php already exists. Please use admin/cli/install_database.php to install Moodle for this site.
moodle_app  | 
moodle_app  | moodle 21:19:42.33 INFO  ==> 
moodle_app  | moodle 21:19:42.33 INFO  ==> Welcome to the Bitnami moodle container
moodle_app  | moodle 21:19:42.33 INFO  ==> Subscribe to project updates by watching https://github.com/bitnami/containers
moodle_app  | moodle 21:19:42.33 INFO  ==> Did you know there are enterprise versions of the Bitnami catalog? For enhanced secure software supply chain features, unlimited pulls from Docker, LTS support, or application customization, see Bitnami Premium or Tanzu Application Catalog. See https://www.arrow.com/globalecs/na/vendors/bitnami/ for more information.
moodle_app  | moodle 21:19:42.33 INFO  ==> 
moodle_app  | moodle 21:19:42.33 INFO  ==> ** Starting Moodle setup **
moodle_app  | moodle 21:19:42.34 DEBUG ==> Validating settings in APACHE_* environment variables
moodle_app  | moodle 21:19:42.35 DEBUG ==> Copying files from /opt/bitnami/apache/conf.default to /opt/bitnami/apache/conf
moodle_app  | moodle 21:19:42.35 INFO  ==> Configuring Apache ServerTokens directive
moodle_app  | moodle 21:19:42.35 DEBUG ==> Configuring ServerTokens Prod on file /opt/bitnami/apache/conf/httpd.conf
moodle_app  | moodle 21:19:42.37 INFO  ==> Configuring PHP options
moodle_app  | moodle 21:19:42.38 INFO  ==> Setting PHP expose_php option
moodle_app  | moodle 21:19:42.38 INFO  ==> Setting PHP max_execution_time option
moodle_app  | moodle 21:19:42.39 INFO  ==> Setting PHP memory_limit option
moodle_app  | moodle 21:19:42.39 INFO  ==> Setting PHP post_max_size option
moodle_app  | moodle 21:19:42.40 INFO  ==> Setting PHP upload_max_filesize option
moodle_app  | moodle 21:19:42.41 INFO  ==> Setting PHP output_buffering option
moodle_app  | moodle 21:19:42.42 INFO  ==> Validating settings in MYSQL_CLIENT_* env vars
moodle_app  | moodle 21:19:42.42 INFO  ==> Validating settings in POSTGRESQL_CLIENT_* env vars
moodle_app  | moodle 21:19:42.44 DEBUG ==> Validating settings in MOODLE_* environment variables...
moodle_app  | moodle 21:19:42.47 INFO  ==> Ensuring Moodle directories exist
moodle_app  | moodle 21:19:42.48 INFO  ==> Trying to connect to the database server
moodle_app  | /opt/bitnami/mysql/bin/mysql: Deprecated program name. It will be removed in a future release, use '/opt/bitnami/mysql/bin/mariadb' instead
moodle_app  | moodle 21:19:42.49 DEBUG ==> Executing SQL command:
moodle_app  | SELECT 1
moodle_app  | /opt/bitnami/mysql/bin/mysql: Deprecated program name. It will be removed in a future release, use '/opt/bitnami/mysql/bin/mariadb' instead
moodle_app  | 1
moodle_app  | moodle 21:19:42.52 INFO  ==> Running Moodle install script
moodle_app  | The configuration file config.php already exists. Please use admin/cli/install_database.php to install Moodle for this site.
moodle_app  | 
moodle_app  | moodle 21:19:43.50 INFO  ==> 
moodle_app  | moodle 21:19:43.50 INFO  ==> Welcome to the Bitnami moodle container
moodle_app  | moodle 21:19:43.50 INFO  ==> Subscribe to project updates by watching https://github.com/bitnami/containers
moodle_app  | moodle 21:19:43.50 INFO  ==> Did you know there are enterprise versions of the Bitnami catalog? For enhanced secure software supply chain features, unlimited pulls from Docker, LTS support, or application customization, see Bitnami Premium or Tanzu Application Catalog. See https://www.arrow.com/globalecs/na/vendors/bitnami/ for more information.
moodle_app  | moodle 21:19:43.50 INFO  ==> 
moodle_app  | moodle 21:19:43.50 INFO  ==> ** Starting Moodle setup **
moodle_app  | moodle 21:19:43.51 DEBUG ==> Validating settings in APACHE_* environment variables
moodle_app  | moodle 21:19:43.52 DEBUG ==> Copying files from /opt/bitnami/apache/conf.default to /opt/bitnami/apache/conf
moodle_app  | moodle 21:19:43.53 INFO  ==> Configuring Apache ServerTokens directive
moodle_app  | moodle 21:19:43.53 DEBUG ==> Configuring ServerTokens Prod on file /opt/bitnami/apache/conf/httpd.conf
moodle_app  | moodle 21:19:43.55 INFO  ==> Configuring PHP options
moodle_app  | moodle 21:19:43.55 INFO  ==> Setting PHP expose_php option
moodle_app  | moodle 21:19:43.56 INFO  ==> Setting PHP max_execution_time option
moodle_app  | moodle 21:19:43.56 INFO  ==> Setting PHP memory_limit option
moodle_app  | moodle 21:19:43.57 INFO  ==> Setting PHP post_max_size option
moodle_app  | moodle 21:19:43.57 INFO  ==> Setting PHP upload_max_filesize option
moodle_app  | moodle 21:19:43.58 INFO  ==> Setting PHP output_buffering option
moodle_app  | moodle 21:19:43.59 INFO  ==> Validating settings in MYSQL_CLIENT_* env vars
moodle_app  | moodle 21:19:43.60 INFO  ==> Validating settings in POSTGRESQL_CLIENT_* env vars
moodle_app  | moodle 21:19:43.62 DEBUG ==> Validating settings in MOODLE_* environment variables...
moodle_app  | moodle 21:19:43.64 INFO  ==> Ensuring Moodle directories exist
moodle_app  | moodle 21:19:43.65 INFO  ==> Trying to connect to the database server
moodle_app  | /opt/bitnami/mysql/bin/mysql: Deprecated program name. It will be removed in a future release, use '/opt/bitnami/mysql/bin/mariadb' instead
moodle_app  | moodle 21:19:43.66 DEBUG ==> Executing SQL command:
moodle_app  | SELECT 1
moodle_app  | /opt/bitnami/mysql/bin/mysql: Deprecated program name. It will be removed in a future release, use '/opt/bitnami/mysql/bin/mariadb' instead
moodle_app  | 1
moodle_app  | moodle 21:19:43.71 INFO  ==> Running Moodle install script
moodle_app  | The configuration file config.php already exists. Please use admin/cli/install_database.php to install Moodle for this site.
moodle_app  | 
moodle_app  | moodle 21:19:45.52 INFO  ==> 
moodle_app  | moodle 21:19:45.52 INFO  ==> Welcome to the Bitnami moodle container
moodle_app  | moodle 21:19:45.52 INFO  ==> Subscribe to project updates by watching https://github.com/bitnami/containers
moodle_app  | moodle 21:19:45.52 INFO  ==> Did you know there are enterprise versions of the Bitnami catalog? For enhanced secure software supply chain features, unlimited pulls from Docker, LTS support, or application customization, see Bitnami Premium or Tanzu Application Catalog. See https://www.arrow.com/globalecs/na/vendors/bitnami/ for more information.
moodle_app  | moodle 21:19:45.52 INFO  ==> 
moodle_app  | moodle 21:19:45.52 INFO  ==> ** Starting Moodle setup **
moodle_app  | moodle 21:19:45.53 DEBUG ==> Validating settings in APACHE_* environment variables
moodle_app  | moodle 21:19:45.54 DEBUG ==> Copying files from /opt/bitnami/apache/conf.default to /opt/bitnami/apache/conf
moodle_app  | moodle 21:19:45.55 INFO  ==> Configuring Apache ServerTokens directive
moodle_app  | moodle 21:19:45.55 DEBUG ==> Configuring ServerTokens Prod on file /opt/bitnami/apache/conf/httpd.conf
moodle_app  | moodle 21:19:45.56 INFO  ==> Configuring PHP options
moodle_app  | moodle 21:19:45.57 INFO  ==> Setting PHP expose_php option
moodle_app  | moodle 21:19:45.57 INFO  ==> Setting PHP max_execution_time option
moodle_app  | moodle 21:19:45.58 INFO  ==> Setting PHP memory_limit option
moodle_app  | moodle 21:19:45.58 INFO  ==> Setting PHP post_max_size option
moodle_app  | moodle 21:19:45.60 INFO  ==> Setting PHP upload_max_filesize option
moodle_app  | moodle 21:19:45.60 INFO  ==> Setting PHP output_buffering option
moodle_app  | moodle 21:19:45.62 INFO  ==> Validating settings in MYSQL_CLIENT_* env vars
moodle_app  | moodle 21:19:45.62 INFO  ==> Validating settings in POSTGRESQL_CLIENT_* env vars
moodle_app  | moodle 21:19:45.64 DEBUG ==> Validating settings in MOODLE_* environment variables...
moodle_app  | moodle 21:19:45.70 INFO  ==> Ensuring Moodle directories exist
moodle_app  | moodle 21:19:45.70 INFO  ==> Trying to connect to the database server
moodle_app  | /opt/bitnami/mysql/bin/mysql: Deprecated program name. It will be removed in a future release, use '/opt/bitnami/mysql/bin/mariadb' instead
moodle_app  | moodle 21:19:45.71 DEBUG ==> Executing SQL command:
moodle_app  | SELECT 1
moodle_app  | /opt/bitnami/mysql/bin/mysql: Deprecated program name. It will be removed in a future release, use '/opt/bitnami/mysql/bin/mariadb' instead
moodle_app  | 1
moodle_app  | moodle 21:19:45.75 INFO  ==> Running Moodle install script
moodle_app  | The configuration file config.php already exists. Please use admin/cli/install_database.php to install Moodle for this site.
moodle_app  | 
moodle_app  | moodle 21:19:49.16 INFO  ==> 
moodle_app  | moodle 21:19:49.16 INFO  ==> Welcome to the Bitnami moodle container
moodle_app  | moodle 21:19:49.16 INFO  ==> Subscribe to project updates by watching https://github.com/bitnami/containers
moodle_app  | moodle 21:19:49.16 INFO  ==> Did you know there are enterprise versions of the Bitnami catalog? For enhanced secure software supply chain features, unlimited pulls from Docker, LTS support, or application customization, see Bitnami Premium or Tanzu Application Catalog. See https://www.arrow.com/globalecs/na/vendors/bitnami/ for more information.
moodle_app  | moodle 21:19:49.16 INFO  ==> 
moodle_app  | moodle 21:19:49.17 INFO  ==> ** Starting Moodle setup **
moodle_app  | moodle 21:19:49.17 DEBUG ==> Validating settings in APACHE_* environment variables
moodle_app  | moodle 21:19:49.18 DEBUG ==> Copying files from /opt/bitnami/apache/conf.default to /opt/bitnami/apache/conf
moodle_app  | moodle 21:19:49.19 INFO  ==> Configuring Apache ServerTokens directive
moodle_app  | moodle 21:19:49.19 DEBUG ==> Configuring ServerTokens Prod on file /opt/bitnami/apache/conf/httpd.conf
moodle_app  | moodle 21:19:49.21 INFO  ==> Configuring PHP options
moodle_app  | moodle 21:19:49.21 INFO  ==> Setting PHP expose_php option
moodle_app  | moodle 21:19:49.22 INFO  ==> Setting PHP max_execution_time option
moodle_app  | moodle 21:19:49.22 INFO  ==> Setting PHP memory_limit option
moodle_app  | moodle 21:19:49.23 INFO  ==> Setting PHP post_max_size option
moodle_app  | moodle 21:19:49.23 INFO  ==> Setting PHP upload_max_filesize option
moodle_app  | moodle 21:19:49.24 INFO  ==> Setting PHP output_buffering option
moodle_app  | moodle 21:19:49.25 INFO  ==> Validating settings in MYSQL_CLIENT_* env vars
moodle_app  | moodle 21:19:49.26 INFO  ==> Validating settings in POSTGRESQL_CLIENT_* env vars
moodle_app  | moodle 21:19:49.28 DEBUG ==> Validating settings in MOODLE_* environment variables...
moodle_app  | moodle 21:19:49.31 INFO  ==> Ensuring Moodle directories exist
moodle_app  | moodle 21:19:49.31 INFO  ==> Trying to connect to the database server
moodle_app  | /opt/bitnami/mysql/bin/mysql: Deprecated program name. It will be removed in a future release, use '/opt/bitnami/mysql/bin/mariadb' instead
moodle_app  | moodle 21:19:49.32 DEBUG ==> Executing SQL command:
moodle_app  | SELECT 1
moodle_app  | /opt/bitnami/mysql/bin/mysql: Deprecated program name. It will be removed in a future release, use '/opt/bitnami/mysql/bin/mariadb' instead
moodle_app  | 1
moodle_app  | moodle 21:19:49.36 INFO  ==> Running Moodle install script
moodle_app  | The configuration file config.php already exists. Please use admin/cli/install_database.php to install Moodle for this site.
moodle_app  | 
moodle_app  | moodle 21:19:55.95 INFO  ==> 
moodle_app  | moodle 21:19:55.95 INFO  ==> Welcome to the Bitnami moodle container
moodle_app  | moodle 21:19:55.96 INFO  ==> Subscribe to project updates by watching https://github.com/bitnami/containers
moodle_app  | moodle 21:19:55.96 INFO  ==> Did you know there are enterprise versions of the Bitnami catalog? For enhanced secure software supply chain features, unlimited pulls from Docker, LTS support, or application customization, see Bitnami Premium or Tanzu Application Catalog. See https://www.arrow.com/globalecs/na/vendors/bitnami/ for more information.
moodle_app  | moodle 21:19:55.96 INFO  ==> 
moodle_app  | moodle 21:19:55.96 INFO  ==> ** Starting Moodle setup **
moodle_app  | moodle 21:19:55.97 DEBUG ==> Validating settings in APACHE_* environment variables
moodle_app  | moodle 21:19:55.97 DEBUG ==> Copying files from /opt/bitnami/apache/conf.default to /opt/bitnami/apache/conf
moodle_app  | moodle 21:19:55.98 INFO  ==> Configuring Apache ServerTokens directive
moodle_app  | moodle 21:19:55.98 DEBUG ==> Configuring ServerTokens Prod on file /opt/bitnami/apache/conf/httpd.conf
moodle_app  | moodle 21:19:56.01 INFO  ==> Configuring PHP options
moodle_app  | moodle 21:19:56.01 INFO  ==> Setting PHP expose_php option
moodle_app  | moodle 21:19:56.01 INFO  ==> Setting PHP max_execution_time option
moodle_app  | moodle 21:19:56.02 INFO  ==> Setting PHP memory_limit option
moodle_app  | moodle 21:19:56.03 INFO  ==> Setting PHP post_max_size option
moodle_app  | moodle 21:19:56.03 INFO  ==> Setting PHP upload_max_filesize option
moodle_app  | moodle 21:19:56.04 INFO  ==> Setting PHP output_buffering option
moodle_app  | moodle 21:19:56.05 INFO  ==> Validating settings in MYSQL_CLIENT_* env vars
moodle_app  | moodle 21:19:56.06 INFO  ==> Validating settings in POSTGRESQL_CLIENT_* env vars
moodle_app  | moodle 21:19:56.09 DEBUG ==> Validating settings in MOODLE_* environment variables...
moodle_app  | moodle 21:19:56.12 INFO  ==> Ensuring Moodle directories exist
moodle_app  | moodle 21:19:56.13 INFO  ==> Trying to connect to the database server
moodle_app  | /opt/bitnami/mysql/bin/mysql: Deprecated program name. It will be removed in a future release, use '/opt/bitnami/mysql/bin/mariadb' instead
moodle_app  | moodle 21:19:56.13 DEBUG ==> Executing SQL command:
moodle_app  | SELECT 1
moodle_app  | /opt/bitnami/mysql/bin/mysql: Deprecated program name. It will be removed in a future release, use '/opt/bitnami/mysql/bin/mariadb' instead
moodle_app  | 1
moodle_app  | moodle 21:19:56.17 INFO  ==> Running Moodle install script
moodle_app  | The configuration file config.php already exists. Please use admin/cli/install_database.php to install Moodle for this site.
moodle_app  | 
moodle_app  | moodle 21:20:09.17 INFO  ==> 
moodle_app  | moodle 21:20:09.17 INFO  ==> Welcome to the Bitnami moodle container
moodle_app  | moodle 21:20:09.17 INFO  ==> Subscribe to project updates by watching https://github.com/bitnami/containers
moodle_app  | moodle 21:20:09.17 INFO  ==> Did you know there are enterprise versions of the Bitnami catalog? For enhanced secure software supply chain features, unlimited pulls from Docker, LTS support, or application customization, see Bitnami Premium or Tanzu Application Catalog. See https://www.arrow.com/globalecs/na/vendors/bitnami/ for more information.
moodle_app  | moodle 21:20:09.18 INFO  ==> 
moodle_app  | moodle 21:20:09.18 INFO  ==> ** Starting Moodle setup **
moodle_app  | moodle 21:20:09.19 DEBUG ==> Validating settings in APACHE_* environment variables
moodle_app  | moodle 21:20:09.19 DEBUG ==> Copying files from /opt/bitnami/apache/conf.default to /opt/bitnami/apache/conf
moodle_app  | moodle 21:20:09.20 INFO  ==> Configuring Apache ServerTokens directive
moodle_app  | moodle 21:20:09.20 DEBUG ==> Configuring ServerTokens Prod on file /opt/bitnami/apache/conf/httpd.conf
moodle_app  | moodle 21:20:09.22 INFO  ==> Configuring PHP options
moodle_app  | moodle 21:20:09.22 INFO  ==> Setting PHP expose_php option
moodle_app  | moodle 21:20:09.23 INFO  ==> Setting PHP max_execution_time option
moodle_app  | moodle 21:20:09.23 INFO  ==> Setting PHP memory_limit option
moodle_app  | moodle 21:20:09.24 INFO  ==> Setting PHP post_max_size option
moodle_app  | moodle 21:20:09.25 INFO  ==> Setting PHP upload_max_filesize option
moodle_app  | moodle 21:20:09.25 INFO  ==> Setting PHP output_buffering option
moodle_app  | moodle 21:20:09.26 INFO  ==> Validating settings in MYSQL_CLIENT_* env vars
moodle_app  | moodle 21:20:09.27 INFO  ==> Validating settings in POSTGRESQL_CLIENT_* env vars
moodle_app  | moodle 21:20:09.29 DEBUG ==> Validating settings in MOODLE_* environment variables...
moodle_app  | moodle 21:20:09.32 INFO  ==> Ensuring Moodle directories exist
moodle_app  | moodle 21:20:09.33 INFO  ==> Trying to connect to the database server
moodle_app  | /opt/bitnami/mysql/bin/mysql: Deprecated program name. It will be removed in a future release, use '/opt/bitnami/mysql/bin/mariadb' instead
moodle_app  | moodle 21:20:09.34 DEBUG ==> Executing SQL command:
moodle_app  | SELECT 1
moodle_app  | /opt/bitnami/mysql/bin/mysql: Deprecated program name. It will be removed in a future release, use '/opt/bitnami/mysql/bin/mariadb' instead
moodle_app  | 1
moodle_app  | moodle 21:20:09.38 INFO  ==> Running Moodle install script
moodle_app  | The configuration file config.php already exists. Please use admin/cli/install_database.php to install Moodle for this site.
moodle_app  | 
moodle_app  | moodle 21:20:35.17 INFO  ==> 
moodle_app  | moodle 21:20:35.17 INFO  ==> Welcome to the Bitnami moodle container
moodle_app  | moodle 21:20:35.17 INFO  ==> Subscribe to project updates by watching https://github.com/bitnami/containers
moodle_app  | moodle 21:20:35.17 INFO  ==> Did you know there are enterprise versions of the Bitnami catalog? For enhanced secure software supply chain features, unlimited pulls from Docker, LTS support, or application customization, see Bitnami Premium or Tanzu Application Catalog. See https://www.arrow.com/globalecs/na/vendors/bitnami/ for more information.
moodle_app  | moodle 21:20:35.17 INFO  ==> 
moodle_app  | moodle 21:20:35.17 INFO  ==> ** Starting Moodle setup **
moodle_app  | moodle 21:20:35.18 DEBUG ==> Validating settings in APACHE_* environment variables
moodle_app  | moodle 21:20:35.19 DEBUG ==> Copying files from /opt/bitnami/apache/conf.default to /opt/bitnami/apache/conf
moodle_app  | moodle 21:20:35.19 INFO  ==> Configuring Apache ServerTokens directive
moodle_app  | moodle 21:20:35.19 DEBUG ==> Configuring ServerTokens Prod on file /opt/bitnami/apache/conf/httpd.conf
moodle_app  | moodle 21:20:35.21 INFO  ==> Configuring PHP options
moodle_app  | moodle 21:20:35.21 INFO  ==> Setting PHP expose_php option
moodle_app  | moodle 21:20:35.22 INFO  ==> Setting PHP max_execution_time option
moodle_app  | moodle 21:20:35.22 INFO  ==> Setting PHP memory_limit option
moodle_app  | moodle 21:20:35.23 INFO  ==> Setting PHP post_max_size option
moodle_app  | moodle 21:20:35.23 INFO  ==> Setting PHP upload_max_filesize option
moodle_app  | moodle 21:20:35.24 INFO  ==> Setting PHP output_buffering option
moodle_app  | moodle 21:20:35.25 INFO  ==> Validating settings in MYSQL_CLIENT_* env vars
moodle_app  | moodle 21:20:35.25 INFO  ==> Validating settings in POSTGRESQL_CLIENT_* env vars
moodle_app  | moodle 21:20:35.27 DEBUG ==> Validating settings in MOODLE_* environment variables...
moodle_app  | moodle 21:20:35.30 INFO  ==> Ensuring Moodle directories exist
moodle_app  | moodle 21:20:35.31 INFO  ==> Trying to connect to the database server
moodle_app  | /opt/bitnami/mysql/bin/mysql: Deprecated program name. It will be removed in a future release, use '/opt/bitnami/mysql/bin/mariadb' instead
moodle_app  | moodle 21:20:35.31 DEBUG ==> Executing SQL command:
moodle_app  | SELECT 1
moodle_app  | /opt/bitnami/mysql/bin/mysql: Deprecated program name. It will be removed in a future release, use '/opt/bitnami/mysql/bin/mariadb' instead
moodle_app  | 1
moodle_app  | moodle 21:20:35.35 INFO  ==> Running Moodle install script
moodle_app  | The configuration file config.php already exists. Please use admin/cli/install_database.php to install Moodle for this site.
moodle_app  | 
moodle_app  | moodle 21:21:26.75 INFO  ==> 
moodle_app  | moodle 21:21:26.75 INFO  ==> Welcome to the Bitnami moodle container
moodle_app  | moodle 21:21:26.75 INFO  ==> Subscribe to project updates by watching https://github.com/bitnami/containers
moodle_app  | moodle 21:21:26.75 INFO  ==> Did you know there are enterprise versions of the Bitnami catalog? For enhanced secure software supply chain features, unlimited pulls from Docker, LTS support, or application customization, see Bitnami Premium or Tanzu Application Catalog. See https://www.arrow.com/globalecs/na/vendors/bitnami/ for more information.
moodle_app  | moodle 21:21:26.75 INFO  ==> 
moodle_app  | moodle 21:21:26.75 INFO  ==> ** Starting Moodle setup **
moodle_app  | moodle 21:21:26.76 DEBUG ==> Validating settings in APACHE_* environment variables
moodle_app  | moodle 21:21:26.77 DEBUG ==> Copying files from /opt/bitnami/apache/conf.default to /opt/bitnami/apache/conf
moodle_app  | moodle 21:21:26.77 INFO  ==> Configuring Apache ServerTokens directive
moodle_app  | moodle 21:21:26.78 DEBUG ==> Configuring ServerTokens Prod on file /opt/bitnami/apache/conf/httpd.conf
moodle_app  | moodle 21:21:26.80 INFO  ==> Configuring PHP options
moodle_app  | moodle 21:21:26.80 INFO  ==> Setting PHP expose_php option
moodle_app  | moodle 21:21:26.81 INFO  ==> Setting PHP max_execution_time option
moodle_app  | moodle 21:21:26.82 INFO  ==> Setting PHP memory_limit option
moodle_app  | moodle 21:21:26.82 INFO  ==> Setting PHP post_max_size option
moodle_app  | moodle 21:21:26.83 INFO  ==> Setting PHP upload_max_filesize option
moodle_app  | moodle 21:21:26.83 INFO  ==> Setting PHP output_buffering option
moodle_app  | moodle 21:21:26.85 INFO  ==> Validating settings in MYSQL_CLIENT_* env vars
moodle_app  | moodle 21:21:26.85 INFO  ==> Validating settings in POSTGRESQL_CLIENT_* env vars
moodle_app  | moodle 21:21:26.87 DEBUG ==> Validating settings in MOODLE_* environment variables...
moodle_app  | moodle 21:21:26.90 INFO  ==> Ensuring Moodle directories exist
moodle_app  | moodle 21:21:26.91 INFO  ==> Trying to connect to the database server
moodle_app  | /opt/bitnami/mysql/bin/mysql: Deprecated program name. It will be removed in a future release, use '/opt/bitnami/mysql/bin/mariadb' instead
moodle_app  | moodle 21:21:26.92 DEBUG ==> Executing SQL command:
moodle_app  | SELECT 1
moodle_app  | /opt/bitnami/mysql/bin/mysql: Deprecated program name. It will be removed in a future release, use '/opt/bitnami/mysql/bin/mariadb' instead
moodle_app  | 1
moodle_app  | moodle 21:21:26.95 INFO  ==> Running Moodle install script
moodle_app  | The configuration file config.php already exists. Please use admin/cli/install_database.php to install Moodle for this site.
moodle_app  | 
moodle_app  | moodle 21:22:27.15 INFO  ==> 
moodle_app  | moodle 21:22:27.15 INFO  ==> Welcome to the Bitnami moodle container
moodle_app  | moodle 21:22:27.15 INFO  ==> Subscribe to project updates by watching https://github.com/bitnami/containers
moodle_app  | moodle 21:22:27.15 INFO  ==> Did you know there are enterprise versions of the Bitnami catalog? For enhanced secure software supply chain features, unlimited pulls from Docker, LTS support, or application customization, see Bitnami Premium or Tanzu Application Catalog. See https://www.arrow.com/globalecs/na/vendors/bitnami/ for more information.
moodle_app  | moodle 21:22:27.15 INFO  ==> 
moodle_app  | moodle 21:22:27.15 INFO  ==> ** Starting Moodle setup **
moodle_app  | moodle 21:22:27.16 DEBUG ==> Validating settings in APACHE_* environment variables
moodle_app  | moodle 21:22:27.17 DEBUG ==> Copying files from /opt/bitnami/apache/conf.default to /opt/bitnami/apache/conf
moodle_app  | moodle 21:22:27.18 INFO  ==> Configuring Apache ServerTokens directive
moodle_app  | moodle 21:22:27.18 DEBUG ==> Configuring ServerTokens Prod on file /opt/bitnami/apache/conf/httpd.conf
moodle_app  | moodle 21:22:27.19 INFO  ==> Configuring PHP options
moodle_app  | moodle 21:22:27.20 INFO  ==> Setting PHP expose_php option
moodle_app  | moodle 21:22:27.21 INFO  ==> Setting PHP max_execution_time option
moodle_app  | moodle 21:22:27.21 INFO  ==> Setting PHP memory_limit option
moodle_app  | moodle 21:22:27.22 INFO  ==> Setting PHP post_max_size option
moodle_app  | moodle 21:22:27.22 INFO  ==> Setting PHP upload_max_filesize option
moodle_app  | moodle 21:22:27.23 INFO  ==> Setting PHP output_buffering option
moodle_app  | moodle 21:22:27.24 INFO  ==> Validating settings in MYSQL_CLIENT_* env vars
moodle_app  | moodle 21:22:27.25 INFO  ==> Validating settings in POSTGRESQL_CLIENT_* env vars
moodle_app  | moodle 21:22:27.27 DEBUG ==> Validating settings in MOODLE_* environment variables...
moodle_app  | moodle 21:22:27.30 INFO  ==> Ensuring Moodle directories exist
moodle_app  | moodle 21:22:27.31 INFO  ==> Trying to connect to the database server
moodle_app  | /opt/bitnami/mysql/bin/mysql: Deprecated program name. It will be removed in a future release, use '/opt/bitnami/mysql/bin/mariadb' instead
moodle_app  | moodle 21:22:27.31 DEBUG ==> Executing SQL command:
moodle_app  | SELECT 1
moodle_app  | /opt/bitnami/mysql/bin/mysql: Deprecated program name. It will be removed in a future release, use '/opt/bitnami/mysql/bin/mariadb' instead
moodle_app  | 1
moodle_app  | moodle 21:22:27.36 INFO  ==> Running Moodle install script
moodle_app  | The configuration file config.php already exists. Please use admin/cli/install_database.php to install Moodle for this site.
moodle_app  | 
moodle_app  | moodle 21:23:27.56 INFO  ==> 
moodle_app  | moodle 21:23:27.56 INFO  ==> Welcome to the Bitnami moodle container
moodle_app  | moodle 21:23:27.56 INFO  ==> Subscribe to project updates by watching https://github.com/bitnami/containers
moodle_app  | moodle 21:23:27.56 INFO  ==> Did you know there are enterprise versions of the Bitnami catalog? For enhanced secure software supply chain features, unlimited pulls from Docker, LTS support, or application customization, see Bitnami Premium or Tanzu Application Catalog. See https://www.arrow.com/globalecs/na/vendors/bitnami/ for more information.
moodle_app  | moodle 21:23:27.57 INFO  ==> 
moodle_app  | moodle 21:23:27.57 INFO  ==> ** Starting Moodle setup **
moodle_app  | moodle 21:23:27.58 DEBUG ==> Validating settings in APACHE_* environment variables
moodle_app  | moodle 21:23:27.58 DEBUG ==> Copying files from /opt/bitnami/apache/conf.default to /opt/bitnami/apache/conf
moodle_app  | moodle 21:23:27.59 INFO  ==> Configuring Apache ServerTokens directive
moodle_app  | moodle 21:23:27.59 DEBUG ==> Configuring ServerTokens Prod on file /opt/bitnami/apache/conf/httpd.conf
moodle_app  | moodle 21:23:27.61 INFO  ==> Configuring PHP options
moodle_app  | moodle 21:23:27.61 INFO  ==> Setting PHP expose_php option
moodle_app  | moodle 21:23:27.61 INFO  ==> Setting PHP max_execution_time option
moodle_app  | moodle 21:23:27.63 INFO  ==> Setting PHP memory_limit option
moodle_app  | moodle 21:23:27.63 INFO  ==> Setting PHP post_max_size option
moodle_app  | moodle 21:23:27.64 INFO  ==> Setting PHP upload_max_filesize option
moodle_app  | moodle 21:23:27.64 INFO  ==> Setting PHP output_buffering option
moodle_app  | moodle 21:23:27.66 INFO  ==> Validating settings in MYSQL_CLIENT_* env vars
moodle_app  | moodle 21:23:27.66 INFO  ==> Validating settings in POSTGRESQL_CLIENT_* env vars
moodle_app  | moodle 21:23:27.68 DEBUG ==> Validating settings in MOODLE_* environment variables...
moodle_app  | moodle 21:23:27.70 INFO  ==> Ensuring Moodle directories exist
moodle_app  | moodle 21:23:27.71 INFO  ==> Trying to connect to the database server
moodle_app  | /opt/bitnami/mysql/bin/mysql: Deprecated program name. It will be removed in a future release, use '/opt/bitnami/mysql/bin/mariadb' instead
moodle_app  | moodle 21:23:27.72 DEBUG ==> Executing SQL command:
moodle_app  | SELECT 1
moodle_app  | /opt/bitnami/mysql/bin/mysql: Deprecated program name. It will be removed in a future release, use '/opt/bitnami/mysql/bin/mariadb' instead
moodle_app  | 1
moodle_app  | moodle 21:23:27.76 INFO  ==> Running Moodle install script
moodle_app  | The configuration file config.php already exists. Please use admin/cli/install_database.php to install Moodle for this site.
moodle_app  | 
moodle_app  | moodle 21:24:28.03 INFO  ==> 
moodle_app  | moodle 21:24:28.03 INFO  ==> Welcome to the Bitnami moodle container
moodle_app  | moodle 21:24:28.03 INFO  ==> Subscribe to project updates by watching https://github.com/bitnami/containers
moodle_app  | moodle 21:24:28.03 INFO  ==> Did you know there are enterprise versions of the Bitnami catalog? For enhanced secure software supply chain features, unlimited pulls from Docker, LTS support, or application customization, see Bitnami Premium or Tanzu Application Catalog. See https://www.arrow.com/globalecs/na/vendors/bitnami/ for more information.
moodle_app  | moodle 21:24:28.03 INFO  ==> 
moodle_app  | moodle 21:24:28.03 INFO  ==> ** Starting Moodle setup **
moodle_app  | moodle 21:24:28.04 DEBUG ==> Validating settings in APACHE_* environment variables
moodle_app  | moodle 21:24:28.05 DEBUG ==> Copying files from /opt/bitnami/apache/conf.default to /opt/bitnami/apache/conf
moodle_app  | moodle 21:24:28.05 INFO  ==> Configuring Apache ServerTokens directive
moodle_app  | moodle 21:24:28.05 DEBUG ==> Configuring ServerTokens Prod on file /opt/bitnami/apache/conf/httpd.conf
moodle_app  | moodle 21:24:28.08 INFO  ==> Configuring PHP options
moodle_app  | moodle 21:24:28.08 INFO  ==> Setting PHP expose_php option
moodle_app  | moodle 21:24:28.09 INFO  ==> Setting PHP max_execution_time option
moodle_app  | moodle 21:24:28.09 INFO  ==> Setting PHP memory_limit option
moodle_app  | moodle 21:24:28.10 INFO  ==> Setting PHP post_max_size option
moodle_app  | moodle 21:24:28.11 INFO  ==> Setting PHP upload_max_filesize option
moodle_app  | moodle 21:24:28.11 INFO  ==> Setting PHP output_buffering option
moodle_app  | moodle 21:24:28.13 INFO  ==> Validating settings in MYSQL_CLIENT_* env vars
moodle_app  | moodle 21:24:28.14 INFO  ==> Validating settings in POSTGRESQL_CLIENT_* env vars
moodle_app  | moodle 21:24:28.16 DEBUG ==> Validating settings in MOODLE_* environment variables...
moodle_app  | moodle 21:24:28.19 INFO  ==> Ensuring Moodle directories exist
moodle_app  | moodle 21:24:28.20 INFO  ==> Trying to connect to the database server
moodle_app  | /opt/bitnami/mysql/bin/mysql: Deprecated program name. It will be removed in a future release, use '/opt/bitnami/mysql/bin/mariadb' instead
moodle_app  | moodle 21:24:28.21 DEBUG ==> Executing SQL command:
moodle_app  | SELECT 1
moodle_app  | /opt/bitnami/mysql/bin/mysql: Deprecated program name. It will be removed in a future release, use '/opt/bitnami/mysql/bin/mariadb' instead
moodle_app  | 1
moodle_app  | moodle 21:24:28.26 INFO  ==> Running Moodle install script
moodle_app  | The configuration file config.php already exists. Please use admin/cli/install_database.php to install Moodle for this site.
moodle_app  | 
moodle_app  | moodle 21:25:28.47 INFO  ==> 
moodle_app  | moodle 21:25:28.47 INFO  ==> Welcome to the Bitnami moodle container
moodle_app  | moodle 21:25:28.47 INFO  ==> Subscribe to project updates by watching https://github.com/bitnami/containers
moodle_app  | moodle 21:25:28.47 INFO  ==> Did you know there are enterprise versions of the Bitnami catalog? For enhanced secure software supply chain features, unlimited pulls from Docker, LTS support, or application customization, see Bitnami Premium or Tanzu Application Catalog. See https://www.arrow.com/globalecs/na/vendors/bitnami/ for more information.
moodle_app  | moodle 21:25:28.47 INFO  ==> 
moodle_app  | moodle 21:25:28.47 INFO  ==> ** Starting Moodle setup **
moodle_app  | moodle 21:25:28.48 DEBUG ==> Validating settings in APACHE_* environment variables
moodle_app  | moodle 21:25:28.49 DEBUG ==> Copying files from /opt/bitnami/apache/conf.default to /opt/bitnami/apache/conf
moodle_app  | moodle 21:25:28.49 INFO  ==> Configuring Apache ServerTokens directive
moodle_app  | moodle 21:25:28.49 DEBUG ==> Configuring ServerTokens Prod on file /opt/bitnami/apache/conf/httpd.conf
moodle_app  | moodle 21:25:28.52 INFO  ==> Configuring PHP options
moodle_app  | moodle 21:25:28.52 INFO  ==> Setting PHP expose_php option
moodle_app  | moodle 21:25:28.53 INFO  ==> Setting PHP max_execution_time option
moodle_app  | moodle 21:25:28.53 INFO  ==> Setting PHP memory_limit option
moodle_app  | moodle 21:25:28.54 INFO  ==> Setting PHP post_max_size option
moodle_app  | moodle 21:25:28.55 INFO  ==> Setting PHP upload_max_filesize option
moodle_app  | moodle 21:25:28.55 INFO  ==> Setting PHP output_buffering option
moodle_app  | moodle 21:25:28.58 INFO  ==> Validating settings in MYSQL_CLIENT_* env vars
moodle_app  | moodle 21:25:28.58 INFO  ==> Validating settings in POSTGRESQL_CLIENT_* env vars
moodle_app  | moodle 21:25:28.60 DEBUG ==> Validating settings in MOODLE_* environment variables...
moodle_app  | moodle 21:25:28.63 INFO  ==> Ensuring Moodle directories exist
moodle_app  | moodle 21:25:28.64 INFO  ==> Trying to connect to the database server
moodle_app  | /opt/bitnami/mysql/bin/mysql: Deprecated program name. It will be removed in a future release, use '/opt/bitnami/mysql/bin/mariadb' instead
moodle_app  | moodle 21:25:28.65 DEBUG ==> Executing SQL command:
moodle_app  | SELECT 1
moodle_app  | /opt/bitnami/mysql/bin/mysql: Deprecated program name. It will be removed in a future release, use '/opt/bitnami/mysql/bin/mariadb' instead
moodle_app  | 1
moodle_app  | moodle 21:25:28.70 INFO  ==> Running Moodle install script
moodle_app  | The configuration file config.php already exists. Please use admin/cli/install_database.php to install Moodle for this site.
moodle_app  | 
moodle_app  | moodle 21:26:28.89 INFO  ==> 
moodle_app  | moodle 21:26:28.89 INFO  ==> Welcome to the Bitnami moodle container
moodle_app  | moodle 21:26:28.89 INFO  ==> Subscribe to project updates by watching https://github.com/bitnami/containers
moodle_app  | moodle 21:26:28.89 INFO  ==> Did you know there are enterprise versions of the Bitnami catalog? For enhanced secure software supply chain features, unlimited pulls from Docker, LTS support, or application customization, see Bitnami Premium or Tanzu Application Catalog. See https://www.arrow.com/globalecs/na/vendors/bitnami/ for more information.
moodle_app  | moodle 21:26:28.89 INFO  ==> 
moodle_app  | moodle 21:26:28.90 INFO  ==> ** Starting Moodle setup **
moodle_app  | moodle 21:26:28.90 DEBUG ==> Validating settings in APACHE_* environment variables
moodle_app  | moodle 21:26:28.91 DEBUG ==> Copying files from /opt/bitnami/apache/conf.default to /opt/bitnami/apache/conf
moodle_app  | moodle 21:26:28.92 INFO  ==> Configuring Apache ServerTokens directive
moodle_app  | moodle 21:26:28.92 DEBUG ==> Configuring ServerTokens Prod on file /opt/bitnami/apache/conf/httpd.conf
moodle_app  | moodle 21:26:28.94 INFO  ==> Configuring PHP options
moodle_app  | moodle 21:26:28.94 INFO  ==> Setting PHP expose_php option
moodle_app  | moodle 21:26:28.95 INFO  ==> Setting PHP max_execution_time option
moodle_app  | moodle 21:26:28.96 INFO  ==> Setting PHP memory_limit option
moodle_app  | moodle 21:26:28.96 INFO  ==> Setting PHP post_max_size option
moodle_app  | moodle 21:26:28.97 INFO  ==> Setting PHP upload_max_filesize option
moodle_app  | moodle 21:26:28.98 INFO  ==> Setting PHP output_buffering option
moodle_app  | moodle 21:26:28.99 INFO  ==> Validating settings in MYSQL_CLIENT_* env vars
moodle_app  | moodle 21:26:29.00 INFO  ==> Validating settings in POSTGRESQL_CLIENT_* env vars
moodle_app  | moodle 21:26:29.02 DEBUG ==> Validating settings in MOODLE_* environment variables...
moodle_app  | moodle 21:26:29.05 INFO  ==> Ensuring Moodle directories exist
moodle_app  | moodle 21:26:29.06 INFO  ==> Trying to connect to the database server
moodle_app  | /opt/bitnami/mysql/bin/mysql: Deprecated program name. It will be removed in a future release, use '/opt/bitnami/mysql/bin/mariadb' instead
moodle_app  | moodle 21:26:29.07 DEBUG ==> Executing SQL command:
moodle_app  | SELECT 1
moodle_app  | /opt/bitnami/mysql/bin/mysql: Deprecated program name. It will be removed in a future release, use '/opt/bitnami/mysql/bin/mariadb' instead
moodle_app  | 1
moodle_app  | moodle 21:26:29.12 INFO  ==> Running Moodle install script
moodle_app  | The configuration file config.php already exists. Please use admin/cli/install_database.php to install Moodle for this site.
moodle_app  | 
rifaterdemsahin@MacBookPro 3_local % 

---

Looking at the logs, it seems the changes to the docker-compose.yml file (specifically updating MOODLE_DATABASE_TYPE to mariadb) haven't fully resolved the issue yet, and the Moodle container is still encountering problems during setup. Let's break this down and fix it step-by-step.
Analysis of Current Logs
Initial Failure Due to Database Type:
[System] must be installed and enabled - Wrong $CFG->dbtype. You need to change it in your config.php file from 'mysqli' to 'mariadb'.
This indicates the initial setup failed because MOODLE_DATABASE_TYPE was still set to mysqli when the config.php file was generated.
Persistent config.php Issue:
The configuration file config.php already exists. Please use admin/cli/install_database.php to install Moodle for this site.
After the initial failure, a config.php file was created and stored in the moodle_data volume (/bitnami/moodle). On subsequent restarts, the Bitnami Moodle container detects this file and refuses to overwrite it, halting the setup process. The config.php still has mysqli as the database type, which is incorrect for MariaDB.
Database Connection Success:
moodle 21:26:29.07 DEBUG ==> Executing SQL command:
SELECT 1
1
The Moodle container can connect to the database successfully, so the network and credentials are fine. The issue lies solely in the setup process.
Restart Loop:
The moodle_app container keeps restarting because the setup script exits with an error (code 1) instead of proceeding to start the Apache server.
Root Cause
The config.php file in the moodle_data volume was generated with mysqli as the database type before you updated MOODLE_DATABASE_TYPE to mariadb.
The Bitnami Moodle imageâ€™s entrypoint script doesnâ€™t overwrite an existing config.php, even if the environment variables have changed, leading to a mismatch between the environment and the persisted configuration.
Fix Steps
To resolve this, we need to:
Clear the broken config.php by resetting the volumes.
Ensure the updated docker-compose.yml (with MOODLE_DATABASE_TYPE: mariadb) is applied.
Restart the containers cleanly.
Step 1: Stop and Remove Containers and Volumes
Since the moodle_data volume contains the problematic config.php, we need to wipe everything and start fresh:
bash
docker-compose down -v
The -v flag removes all volumes (moodle_data, moodledata_data, db_data), ensuring no residual configuration persists.
Step 2: Verify Updated docker-compose.yml
Make sure your docker-compose.yml reflects the change to mariadb. It should look like this (with version removed as itâ€™s obsolete):
yaml
services:
  moodle:
    image: my-moodle:latest
    container_name: moodle_app
    restart: always
    ports:
      - "80:80"
    environment:
      MOODLE_DATABASE_TYPE: mariadb  # Ensure this is set to mariadb
      MOODLE_DATABASE_HOST: db
      MOODLE_DATABASE_PORT_NUMBER: 3306
      MOODLE_DATABASE_NAME: moodle
      MOODLE_DATABASE_USER: moodle
      MOODLE_DATABASE_PASSWORD: "SafeP@ssw0rd-123"
      MOODLE_USERNAME: admin
      MOODLE_PASSWORD: "SecureAdminP@ssw0rd456"
      MOODLE_EMAIL: contact@rifaterdemsahin.com
      MOODLE_SITE_NAME: "Moodle LMS"
      MOODLE_HOST: "localhost"
      PHP_MAX_EXECUTION_TIME: 300
      PHP_MEMORY_LIMIT: 256M
      PHP_POST_MAX_SIZE: 50M
      PHP_UPLOAD_MAX_FILESIZE: 50M
      BITNAMI_DEBUG: "true"
    volumes:
      - moodle_data:/bitnami/moodle
      - moodledata_data:/bitnami/moodledata
    depends_on:
      - db
    networks:
      - moodle-net

  db:
    image: mariadb:10.6
    container_name: moodle_db
    restart: always
    environment:
      MYSQL_DATABASE: moodle
      MYSQL_USER: moodle
      MYSQL_PASSWORD: "SafeP@ssw0rd-123"
      MYSQL_ROOT_PASSWORD: "RootP@ssw0rd789"
    volumes:
      - db_data:/var/lib/mysql
    networks:
      - moodle-net
    command: --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci

volumes:
  moodle_data:
  moodledata_data:
  db_data:

networks:
  moodle-net:
    driver: bridge
If youâ€™ve already updated this file, proceed to the next step. If not, update it now and save it.
Step 3: Start the Services
Start the containers with the updated configuration:
bash
docker-compose up --force-recreate
The --force-recreate flag ensures new containers are created, applying the updated environment variables.
Step 4: Monitor Logs
Watch the logs to confirm the setup completes successfully:
bash
docker-compose logs -f
Look for:
The database initializing (moodle_db logs showing "ready for connections").
The Moodle setup running without the mysqli error and completing the installation.
Apache starting (e.g., "Starting Apache..." or similar), indicating the setup succeeded and the web server is running.
Step 5: Access Moodle
Once the logs show the setup is complete and Apache is running, open your browser and navigate to:
http://localhost
Log in with:
Username: admin
Password: SecureAdminP@ssw0rd456
If Issues Persist
If the setup still fails or you see the same errors:
Manually Inspect config.php:
Exec into the container after it starts:
bash
docker exec -it moodle_app bash
cat /bitnami/moodle/config.php
Check if $CFG->dbtype is set to 'mariadb'. If itâ€™s still 'mysqli', the environment variable isnâ€™t being applied correctly. Double-check your docker-compose.yml and ensure no old images are cached (docker-compose pull to update).
Manually Complete Installation:
If the automatic setup fails again, you can manually install the database:
bash
docker exec -it moodle_app bash
php /bitnami/moodle/admin/cli/install_database.php
This should use the existing config.php (now with mariadb) to set up the database tables.
Clear Cached Images:
If the image my-moodle:latest is outdated or cached, pull the latest version:
bash
docker-compose pull
Expected Outcome
With the volumes cleared and MOODLE_DATABASE_TYPE set to mariadb, the Moodle container should:
Generate a new config.php with the correct database type.
Complete the installation without errors.
Start the Apache server, making Moodle accessible at http://localhost.
Let me know how it goes or if you need further assistance!

---

The error indicates that the moodle_app container is not running, which explains why you canâ€™t access /bitnami/moodle/config.php. This aligns with the logs you shared earlier, where the container keeps exiting with code 1 due to setup failures. Letâ€™s address this systematically to get the container running and Moodle fully installed.
Why the Container Isnâ€™t Running
The moodle_app container is exiting because the Bitnami Moodle setup script fails during initialization. The logs show two key issues:
The initial run failed due to MOODLE_DATABASE_TYPE being set to mysqli instead of mariadb, creating a config.php with the wrong database type.
Subsequent runs detect the existing config.php and exit with:
The configuration file config.php already exists. Please use admin/cli/install_database.php to install Moodle for this site.
However, the container doesnâ€™t proceed to a running state because the setup process isnâ€™t completed.
Since youâ€™ve run docker-compose down -v and updated the docker-compose.yml to use MOODLE_DATABASE_TYPE: mariadb, the issue now is likely that the container isnâ€™t staying alive long enough for you to debug it interactively, or thereâ€™s a lingering misconfiguration.
Next Steps
Letâ€™s get the container running, verify the setup, and complete the installation.
Step 1: Restart with Fresh Setup
Since youâ€™ve already cleared the volumes with docker-compose down -v and updated the docker-compose.yml, start the services again:
bash
docker-compose up -d --force-recreate
-d runs the containers in detached mode (in the background).
--force-recreate ensures fresh containers are created with the latest configuration.
Step 2: Check Container Status
Verify if moodle_app is running:
bash
docker ps -a
If moodle_app shows Exited, note the exit code (e.g., 1) and proceed to the logs.
If itâ€™s running, skip to Step 4.
Step 3: Inspect Logs
Check the logs to see why itâ€™s exiting:
bash
docker-compose logs moodle_app
Look for errors. Based on your previous logs, you might see:
The mysqli error (if the updated mariadb setting didnâ€™t take effect).
The config.php already exists message (if volumes werenâ€™t fully cleared).
If the logs show the container exiting, proceed to Step 4 to debug interactively.
Step 4: Debug Interactively
Since the container isnâ€™t staying alive, override the entrypoint to keep it running so you can investigate:
bash
docker run -it --rm --network 3_local_moodle-net -v moodle_data:/bitnami/moodle -v moodledata_data:/bitnami/moodledata -e MOODLE_DATABASE_TYPE=mariadb -e MOODLE_DATABASE_HOST=db -e MOODLE_DATABASE_PORT_NUMBER=3306 -e MOODLE_DATABASE_NAME=moodle -e MOODLE_DATABASE_USER=moodle -e MOODLE_DATABASE_PASSWORD="SafeP@ssw0rd-123" -e MOODLE_USERNAME=admin -e MOODLE_PASSWORD="SecureAdminP@ssw0rd456" -e MOODLE_EMAIL=contact@rifaterdemsahin.com -e MOODLE_SITE_NAME="Moodle LMS" -e MOODLE_HOST=localhost my-moodle:latest bash
This starts a temporary container with a shell, using the same environment variables and volumes as your docker-compose.yml.
Ensure the moodle_db container is running (docker-compose up -d) so the network and database are available.
Inside the container:
Check Database Connectivity:
bash
/opt/bitnami/mysql/bin/mysql -h db -u moodle -p"SafeP@ssw0rd-123" -e "SELECT 1"
This should return 1, confirming the database connection works.
Run the Setup Script Manually:
bash
/opt/bitnami/scripts/moodle/entrypoint.sh /opt/bitnami/scripts/moodle/run.sh
Watch the output. If it fails due to config.php issues or database type mismatches, note the error.
Inspect or Remove config.php:
bash
ls -l /bitnami/moodle/config.php
If it exists (unlikely since volumes were cleared), view it:
bash
cat /bitnami/moodle/config.php
Check if $CFG->dbtype is 'mariadb'. If itâ€™s 'mysqli' or the file shouldnâ€™t exist, delete it:
bash
rm /bitnami/moodle/config.php
Then rerun the setup script.
Install Database Manually (if Needed):
If the setup script still fails or skips database installation:
bash
php /bitnami/moodle/admin/cli/install_database.php
This should complete the database setup using the environment variables.
Step 5: Update Docker Compose and Test
If the manual setup works, the issue is with the automatic startup. Adjust docker-compose.yml to ensure it completes the installation and stays running. Add a custom command to force the database install on first run:
yaml
services:
  moodle:
    image: my-moodle:latest
    container_name: moodle_app
    restart: always
    ports:
      - "80:80"
    environment:
      MOODLE_DATABASE_TYPE: mariadb
      MOODLE_DATABASE_HOST: db
      MOODLE_DATABASE_PORT_NUMBER: 3306
      MOODLE_DATABASE_NAME: moodle
      MOODLE_DATABASE_USER: moodle
      MOODLE_DATABASE_PASSWORD: "SafeP@ssw0rd-123"
      MOODLE_USERNAME: admin
      MOODLE_PASSWORD: "SecureAdminP@ssw0rd456"
      MOODLE_EMAIL: contact@rifaterdemsahin.com
      MOODLE_SITE_NAME: "Moodle LMS"
      MOODLE_HOST: "localhost"
      PHP_MAX_EXECUTION_TIME: 300
      PHP_MEMORY_LIMIT: 256M
      PHP_POST_MAX_SIZE: 50M
      PHP_UPLOAD_MAX_FILESIZE: 50M
      BITNAMI_DEBUG: "true"
    volumes:
      - moodle_data:/bitnami/moodle
      - moodledata_data:/bitnami/moodledata
    depends_on:
      - db
    networks:
      - moodle-net
    command: >
      bash -c "if [ ! -f /bitnami/moodle/config.php ]; then /opt/bitnami/scripts/moodle/entrypoint.sh /opt/bitnami/scripts/moodle/run.sh; else php /bitnami/moodle/admin/cli/install_database.php && /opt/bitnami/scripts/moodle/run.sh; fi"

  db:
    image: mariadb:10.6
    container_name: moodle_db
    restart: always
    environment:
      MYSQL_DATABASE: moodle
      MYSQL_USER: moodle
      MYSQL_PASSWORD: "SafeP@ssw0rd-123"
      MYSQL_ROOT_PASSWORD: "RootP@ssw0rd789"
    volumes:
      - db_data:/var/lib/mysql
    networks:
      - moodle-net
    command: --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci

volumes:
  moodle_data:
  moodledata_data:
  db_data:

networks:
  moodle-net:
    driver: bridge
The command checks if config.php exists. If not, it runs the full setup. If it does, it installs the database and starts the server.
Restart with:
bash
docker-compose down -v && docker-compose up -d
Step 6: Verify
Check if moodle_app is running:
bash
docker ps
View logs:
bash
docker-compose logs -f
Access http://localhost in your browser.
Expected Outcome
The container should stay running, and Moodle should be accessible. If it still fails, share the updated logs from Step 3 or Step 6, and Iâ€™ll refine the solution further!

---

root@6bdb0b6800eb:/# /opt/bitnami/mysql/bin/mysql -h db -u moodle -p"SafeP@ssw0rd-123" -e "SELECT 1"
/opt/bitnami/mysql/bin/mysql: Deprecated program name. It will be removed in a future release, use '/opt/bitnami/mysql/bin/mariadb' instead
ERROR 2005 (HY000): Unknown server host 'db' (-2)
root@6bdb0b6800eb:/# 

---

The error ERROR 2005 (HY000): Unknown server host 'db' (-2) indicates that the moodle_app container cannot resolve the hostname db to connect to the MariaDB database container. This is a networking issue within Docker, likely because the temporary container you started with docker run isnâ€™t properly linked to the moodle_db container via the Docker network defined in your docker-compose.yml.
Why This Happened
When you ran the docker run command to debug interactively:
bash
docker run -it --rm --network 3_local_moodle-net ...
You specified the network 3_local_moodle-net, but thereâ€™s a chance:
The network name is incorrect (e.g., it might not match the actual network created by Docker Compose).
The moodle_db container wasnâ€™t running or attached to that network at the time you ran the command.
Docker Compose prefixes network names with the project directory name (e.g., 3_local_moodle-net if your directory is 3_local), but if the network wasnâ€™t created or the moodle_db container isnâ€™t active, the hostname db wonâ€™t resolve.
Fix Steps
Letâ€™s ensure the database is running and the containers are on the same network, then test connectivity and proceed with the setup.
Step 1: Verify moodle_db Is Running
Start your Docker Compose setup to ensure the database container is up:
bash
cd /Users/rifaterdemsahin/projects/Moodle/6_ðŸ”£_Symbols/3_local
docker-compose up -d
Check the status:
bash
docker ps -a
Look for moodle_db. If itâ€™s not running, check its logs:
bash
docker-compose logs moodle_db
If itâ€™s exited, fix any errors (e.g., volume permissions, misconfiguration) and restart:
bash
docker-compose restart db
Step 2: Confirm Network Name
List Docker networks to verify the correct network name:
bash
docker network ls
You should see something like 3_local_moodle-net (based on your directory 3_local and the moodle-net network in docker-compose.yml). Note the exact name.
Inspect the network to ensure moodle_db is attached:
bash
docker network inspect 3_local_moodle-net
Look under "Containers" for an entry with moodle_db. If itâ€™s missing, the db service didnâ€™t start correctlyâ€”revisit Step 1.
Step 3: Test Connectivity with Correct Network
Run a temporary container with the correct network and environment variables, ensuring moodle_db is running:
bash
docker run -it --rm --network 3_local_moodle-net -e MOODLE_DATABASE_HOST=db -e MOODLE_DATABASE_USER=moodle -e MOODLE_DATABASE_PASSWORD="SafeP@ssw0rd-123" my-moodle:latest bash
Inside the container, test the database connection:
bash
/opt/bitnami/mysql/bin/mysql -h db -u moodle -p"SafeP@ssw0rd-123" -e "SELECT 1"
Youâ€™ll see the deprecated warning, but it should return 1 if successful.
If it still fails with Unknown server host 'db', double-check the network name and ensure moodle_db is running and on the same network.
Alternatively, use the MariaDB client directly to avoid the warning:
bash
/opt/bitnami/mysql/bin/mariadb -h db -u moodle -p"SafeP@ssw0rd-123" -e "SELECT 1"
Step 4: Proceed with Setup (If Connectivity Works)
Once the database connection succeeds (you see 1), continue the manual setup inside the same container:
Run the Setup Script:
bash
/opt/bitnami/scripts/moodle/entrypoint.sh /opt/bitnami/scripts/moodle/run.sh
This should generate a new config.php with MOODLE_DATABASE_TYPE=mariadb (since you set it in the environment).
Check config.php:
bash
cat /bitnami/moodle/config.php
Verify $CFG->dbtype = 'mariadb';.
Install Database (If Needed):
If the setup script doesnâ€™t complete the database installation:
bash
php /bitnami/moodle/admin/cli/install_database.php
Exit and Test:
Exit the container (exit), then restart your Docker Compose setup:
bash
docker-compose down -v && docker-compose up -d
Check logs:
bash
docker-compose logs -f
Access http://localhost.
Step 5: Fix Docker Compose (If Needed)
If the above works manually but fails in docker-compose up, update your docker-compose.yml to ensure proper startup. Hereâ€™s the version with the custom command from earlier:
yaml
services:
  moodle:
    image: my-moodle:latest
    container_name: moodle_app
    restart: always
    ports:
      - "80:80"
    environment:
      MOODLE_DATABASE_TYPE: mariadb
      MOODLE_DATABASE_HOST: db
      MOODLE_DATABASE_PORT_NUMBER: 3306
      MOODLE_DATABASE_NAME: moodle
      MOODLE_DATABASE_USER: moodle
      MOODLE_DATABASE_PASSWORD: "SafeP@ssw0rd-123"
      MOODLE_USERNAME: admin
      MOODLE_PASSWORD: "SecureAdminP@ssw0rd456"
      MOODLE_EMAIL: contact@rifaterdemsahin.com
      MOODLE_SITE_NAME: "Moodle LMS"
      MOODLE_HOST: "localhost"
      PHP_MAX_EXECUTION_TIME: 300
      PHP_MEMORY_LIMIT: 256M
      PHP_POST_MAX_SIZE: 50M
      PHP_UPLOAD_MAX_FILESIZE: 50M
      BITNAMI_DEBUG: "true"
    volumes:
      - moodle_data:/bitnami/moodle
      - moodledata_data:/bitnami/moodledata
    depends_on:
      - db
    networks:
      - moodle-net
    command: >
      bash -c "if [ ! -f /bitnami/moodle/config.php ]; then /opt/bitnami/scripts/moodle/entrypoint.sh /opt/bitnami/scripts/moodle/run.sh; else php /bitnami/moodle/admin/cli/install_database.php && /opt/bitnami/scripts/moodle/run.sh; fi"

  db:
    image: mariadb:10.6
    container_name: moodle_db
    restart: always
    environment:
      MYSQL_DATABASE: moodle
      MYSQL_USER: moodle
      MYSQL_PASSWORD: "SafeP@ssw0rd-123"
      MYSQL_ROOT_PASSWORD: "RootP@ssw0rd789"
    volumes:
      - db_data:/var/lib/mysql
    networks:
      - moodle-net
    command: --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci

volumes:
  moodle_data:
  moodledata_data:
  db_data:

networks:
  moodle-net:
    driver: bridge
Restart:
bash
docker-compose down -v && docker-compose up -d
Troubleshooting
If db still isnâ€™t resolving:
Ping Test: Inside the temporary container, run:
bash
ping db
If it fails, the network linkage is broken.
Explicit Network: Ensure the network name matches exactly (e.g., 3_local_moodle-net).
Restart Docker: On rare occasions, Dockerâ€™s networking stack can glitch. Restart the Docker daemon:
bash
sudo systemctl restart docker  # Linux
# Or restart Docker Desktop on macOS
Expected Outcome
The database connection should work, the setup should complete, and Moodle should be accessible at http://localhost. If you hit another snag, share the output from Step 3 or the updated logs, and Iâ€™ll dig deeper!